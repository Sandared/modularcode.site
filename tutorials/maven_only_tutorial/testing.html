<!DOCTYPE html>
<html lang="en"><head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
    <title>Integration Testing</title>
    <meta name="description" content="Integration Testing" />
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen,projection" href="/assets/materialize.css" />
    <link rel="canonical" href="/tutorials/maven_only_tutorial/testing.html" />
    <link rel="alternate" type="application/rss+xml" title="modularcode" href="/feed.xml" />
    
</head>
<!-- Is it a content or a nested page -->
	
	
	
	<style>a {color: #757575;fill:#424242;}a:hover {color: #03a9f4;fill:#03a9f4;}h1,h2,h3,h4,h5,h6{color: #424242;}body{color: #212121; display: flex; min-height: 100vh; flex-direction: column;}nav ul a{color: #424242;}nav .brand-logo{color: #424242}.justify-align{text-align:justify;}nav a{color: #424242;}main{flex: 1 0 auto;}.side-nav li>a{color: #424242;}.side-nav .collapsible-header, .side-nav.fixed .collapsible-header{padding-left:32px;}.side-nav .collapsible-body li a, .side-nav.fixed .collapsible-body li a{padding-left:47px;}h1,h2,h3,h4,h5,h6{-webkit-font-smoothing: antialiased;}.icon-block{padding: 0 15px;}.icon-block .material-icons{font-size: inherit;}.row{margin-bottom:0px;}.logo img{padding-top:3px;}.page-footer{background-color:#03a9f4; padding-top: 0px;}.nav-button{width:20px; height:20px; viewBox:0 0 20 20;}footer h5{color:#FFFFFF;}hr{background-color:#bdbdbd;}.divider{background-color:#bdbdbd;}img{max-width: 100%; height: auto;}.page-footer .footer-copyright{background-color:#03a9f4;}/* Code Highlighting */.highlight .c { color: #bdbdbd; font-style: italic } /* Comment */.highlight .k { color: #212121; font-weight: bold } /* Keyword */.highlight .cm { color: #bdbdbd; font-style: italic } /* Comment.Multiline */.highlight .c1 { color: #bdbdbd; font-style: italic } /* Comment.Single */.highlight .kc { color: #424242; font-weight: bold } /* Keyword.Constant */.highlight .kd { color: #212121; font-weight: bold } /* Keyword.Declaration */.highlight .kn { color: #424242; font-weight: bold } /* Keyword.Namespace */.highlight .kp { color: #424242; font-weight: bold } /* Keyword.Pseudo */.highlight .kr { color: #424242; font-weight: bold } /* Keyword.Reserved */.highlight .kt { color: #424242; font-weight: bold } /* Keyword.Type */.highlight .s { color: #757575 } /* Literal.String */.highlight .n { color: #03a9f4 } /* Name */.highlight .na { color: #03a9f4 } /* Name.Attribute */.highlight .nc { color: #03a9f4} /* Name.Class */.highlight .nd { color: #757575 } /* Name.Decorator */.highlight .nf { color: #03a9f4 } /* Name.Function */.highlight .mf { color: #757575 } /* Literal.Number.Float */.highlight .mh { color: #757575 } /* Literal.Number.Hex */.highlight .mi { color: #757575 } /* Literal.Number.Integer */.highlight .mo { color: #757575 } /* Literal.Number.Oct */.highlight .sb { color: #757575 } /* Literal.String.Backtick */.highlight .sc { color: #757575 } /* Literal.String.Char */.highlight .sd { color: #757575 } /* Literal.String.Doc */.highlight .s2 { color: #757575 } /* Literal.String.Double */.highlight .se { color: #757575 } /* Literal.String.Escape */.highlight .sh { color: #757575 } /* Literal.String.Heredoc */.highlight .si { color:#757575 } /* Literal.String.Interpol */.highlight .sx { color: #757575 } /* Literal.String.Other */.highlight .sr { color: #757575 } /* Literal.String.Regex */.highlight .s1 { color: #757575 } /* Literal.String.Single */.highlight .ss { color: #757575 } /* Literal.String.Symbol */.highlight {tab-size: 4;}div.highlighter-rouge{padding:5px;background:#f5f5f5;border:1px solid #bdbdbd;border-radius:4px;}div.highlight pre.highlight{margin:0px;}code.highlighter-rouge{padding:0px 3px;background:#f5f5f5;border:1px solid #bdbdbd;border-radius:3px;}/* Make headers a little bit smaller */h1{font-size:2.8rem;}h2{font-size:2.5rem;}h3{font-size:2.1rem;}h4{font-size:1.8rem;}h5{font-size:1.3rem;}h6{font-size:1rem;}/* Plain text */p{text-align:justify;}/* Blockquotes */blockquote{border-left:3px solid #03a9f4;font-style:italic;font-weight:300;}/* Tables */table.striped>tbody>tr:nth-child(odd){background-color:#f5f5f5;}/* Cards */.card .card-image .card-title{color: #212121; font-weight: 600; padding-bottom: 0px; padding-left:12px; padding-right: 12px;}.card-content{color: #757575;}.card .card-content{padding-top: 5px;}.card .card-action a:not(.btn):not(.btn-large):not(.btn-large):not(.btn-floating){color: #424242;}.card .card-action a:not(.btn):not(.btn-large):not(.btn-large):not(.btn-floating):hover{color: #03a9f4;}.card.small{height: 225px;}.card-placeholder-image{color:#bdbdbd;}.card-image img{opacity: 0.3;}.card-image h2{opacity: 0.3;}.card .card-image{min-height:60%;}/* Breadcrumbs */nav{background-color: #FFFFFF;}a.breadcrumb{color: #757575;}.breadcrumb:last-child{color:#03a9f4;}.breadcrumb:before{color:#757575;font-size:15px;}nav.breadcrumbs{box-shadow:none;margin-top:4px;}ul.collapsible{list-style-type: none;padding:0px;}.collapsible-header{border-bottom:0px;}.collapsible-body{padding:5px;}/* Table of Contents */.second-level{padding:0px;}.table-of-contents .second-level a{padding-left:40px;font-size:13px;}.table-of-contents a{color:#757575;}.table-of-contents a:hover{border-left:1px solid #03a9f4;color:#03a9f4;}.table-of-contents a.active{border-left:2px solid #03a9f4;color:#757575;}.toc-wrapper li{padding:1px;}/* Navigation Arrows */.prev-nav{top: 50%;left: 3%;position:fixed;}.next-nav{top: 50%;right: 3%;position:fixed;}</style>

  <body>
	<!-- Navigation Header -->
	<nav class="white lighten-1" role="navigation">
	<div class="nav-wrapper container">
		<a id="logo-container" class="brand-logo logo show-on-medium-and-up hide-on-small-only" href="/"><img src="/logo.png"></a>
		<a id="logo-container" class="brand-logo logo show-on-small hide-on-med-and-up" href="/"><img src="/logo-small.png"></a>
	  
	  
	
	  <ul class="right hide-on-med-and-down">
		
			
			<li><a href="/tutorials.html">Tutorials</a></li>
		
			
			<li><a href="/modules.html">Modules</a></li>
		
			
			<li><a href="/projects.html">Projects</a></li>
		
			
			<li><a href="/contribute.html">Contribute</a></li>
		
		
			<li>
				<a title="modularcode.site on GitHub" href="https://github.com/Sandared/modularcode.site"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>github</title>
						<path d="M10 0C4.477 0 0 4.477 0 10c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.342-3.369-1.342-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.268 2.75 1.026A9.578 9.578 0 0 1 10 4.836c.85.004 1.705.114 2.504.337 1.909-1.294 2.747-1.026 2.747-1.026.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.579.688.481C17.137 18.163 20 14.418 20 10c0-5.523-4.478-10-10-10" fill-rule="evenodd">
						</path>
					</svg>					
				</a>
			</li>
		
		
		
			<li>
				<a title="SanfteSchorle on Twitter" href="https://twitter.com/SanfteSchorle"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>twitter</title>
						<path d="M15.115 7.788c.005.11.009.223.009.335 0 3.43-2.611 7.384-7.386 7.384-1.467 0-2.831-.43-3.98-1.166a5.244 5.244 0 0 0 3.843-1.075 2.596 2.596 0 0 1-2.424-1.801 2.645 2.645 0 0 0 1.171-.045 2.597 2.597 0 0 1-2.082-2.544v-.033c.351.194.752.311 1.177.324a2.59 2.59 0 0 1-1.154-2.16c0-.475.127-.92.35-1.305A7.37 7.37 0 0 0 9.99 8.414a2.596 2.596 0 0 1 4.423-2.367 5.174 5.174 0 0 0 1.648-.63 2.602 2.602 0 0 1-1.142 1.436 5.17 5.17 0 0 0 1.491-.41 5.233 5.233 0 0 1-1.295 1.345M10 0C4.486 0 0 4.486 0 10s4.486 10 10 10 10-4.486 10-10S15.514 0 10 0" fill-rule="evenodd">
						</path>
					</svg>			
				</a>
			</li>
		
	  </ul>

	  <ul id="nav-mobile" class="side-nav">
		<li><a href="">Home</a></li>
		<li class="divider"></li>
		
			
			<li><a href="/tutorials.html">Tutorials</a></li>
			<li class="divider"></li>
		
			
			<li><a href="/modules.html">Modules</a></li>
			<li class="divider"></li>
		
			
			<li><a href="/projects.html">Projects</a></li>
			<li class="divider"></li>
		
			
			<li><a href="/contribute.html">Contribute</a></li>
			<li class="divider"></li>
		
		
			<li>
				<a title="modularcode.site on GitHub" href="https://github.com/Sandared/modularcode.site"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>github</title>
						<path d="M10 0C4.477 0 0 4.477 0 10c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.342-3.369-1.342-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.268 2.75 1.026A9.578 9.578 0 0 1 10 4.836c.85.004 1.705.114 2.504.337 1.909-1.294 2.747-1.026 2.747-1.026.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.579.688.481C17.137 18.163 20 14.418 20 10c0-5.523-4.478-10-10-10" fill-rule="evenodd">
						</path>
					</svg>					
				</a>
			</li>
			<li class="divider"></li>
		
		
		
			<li>
				<a title="SanfteSchorle on Twitter" href="https://twitter.com/SanfteSchorle"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>twitter</title>
						<path d="M15.115 7.788c.005.11.009.223.009.335 0 3.43-2.611 7.384-7.386 7.384-1.467 0-2.831-.43-3.98-1.166a5.244 5.244 0 0 0 3.843-1.075 2.596 2.596 0 0 1-2.424-1.801 2.645 2.645 0 0 0 1.171-.045 2.597 2.597 0 0 1-2.082-2.544v-.033c.351.194.752.311 1.177.324a2.59 2.59 0 0 1-1.154-2.16c0-.475.127-.92.35-1.305A7.37 7.37 0 0 0 9.99 8.414a2.596 2.596 0 0 1 4.423-2.367 5.174 5.174 0 0 0 1.648-.63 2.602 2.602 0 0 1-1.142 1.436 5.17 5.17 0 0 0 1.491-.41 5.233 5.233 0 0 1-1.295 1.345M10 0C4.486 0 0 4.486 0 10s4.486 10 10 10 10-4.486 10-10S15.514 0 10 0" fill-rule="evenodd">
						</path>
					</svg>			
				</a>
			</li>
			<li class="divider"></li>
		
	  </ul>        

	  <a data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
	</div>
</nav>
	
	
	
  <main>	
  <div class="container">
		<div class="row">	
		
			<div id="text-content" class="section col s12 l10">
				


<nav class="breadcrumbs">
	<div class="nav-wrapper">
	
	
		
	
		
			
			
			
			
			
							
				
				
							
				
				
							
				
				
			
				
					
					<a href="/tutorials.html" class="breadcrumb">Tutorials</a>
				
			
		
	
		
			
			
			
			
			
							
				
				
							
				
				
							
				
				
					
				
				<a href="/tutorials/maven_only_tutorial.html" class="breadcrumb">Maven ONLY Tutorial</a>
				
			
		
	
		
			
			
			
			
			
							
				
				
							
				
				
							
				
				
					
				
				<a href="/tutorials/maven_only_tutorial/testing.html" class="breadcrumb">Integration Testing</a>
				
			
		
	
	</div>
</nav>

				<h1 id="integration-testing">Integration Testing</h1>

<h2 id="what-you-will-learn-in-this-section">What you will learn in this section</h2>

<p>In this section we will create an OSGi integration test. We will use
the bnd-testing-maven-plugin to setup a runtime environment and then
run our JUnit tests inside OSGi.</p>

<p>Make sure you are in the top directory:</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd ~/workspaces/osgi.enroute.examples.eval
</code></pre></div></div>

<h2 id="create-a-test-bundle">Create a Test Bundle</h2>

<p>We will first create a test bundle. A test bundle is one one or more classes
with JUnit tests. Each bundle will list its test classes in the Test-Cases
manifest header. The bnd runtime support has a tester that will look for bundles
with this header and then automatically runs these test.</p>

<p>In this instance, we want to define a test to verify the Eval service.</p>

<h2 id="create-the-pom">Create the pom</h2>

<p>Let’s create the pom.</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>osgi.enroute.examples.eval $ mkdir test
osgi.enroute.examples.eval $ cd test
test $ vi pom.xml
// get the content
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;project 
	xmlns="http://maven.apache.org/POM/4.0.0" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
	
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

	&lt;parent&gt;
		&lt;groupId&gt;org.osgi&lt;/groupId&gt;
		&lt;artifactId&gt;osgi.enroute.examples.eval&lt;/artifactId&gt;
		&lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
	&lt;/parent&gt;

	&lt;artifactId&gt;osgi.enroute.examples.eval.test&lt;/artifactId&gt;
</code></pre></div></div>

<p>We need the API bundle and JUnit as dependencies. We use the OSGi enRoute wrapped
version of JUnit because JUnit normally does not contain OSGi metadata and many
wrappers have problems.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.osgi&lt;/groupId&gt;
			&lt;artifactId&gt;osgi.enroute.examples.eval.api&lt;/artifactId&gt;
			&lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.osgi&lt;/groupId&gt;
			&lt;artifactId&gt;osgi.enroute.junit.wrapper&lt;/artifactId&gt;
			&lt;version&gt;4.12.0&lt;/version&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;

&lt;/project&gt;
</code></pre></div></div>

<h2 id="the-source-code">The Source Code</h2>

<p>It is a tad confusing but the source code for an integration test bundle <em>must</em> be
in the <code class="highlighter-rouge">src/main/java</code> directory, <em>not</em> in the <code class="highlighter-rouge">test</code> directory. This makes sense
if you realize that we’re making a bundle and the sole purpose of a test branch
in the src directory is to make sure that code does not end up in a bundle.</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test $ mkdir -p src/main/java/osgi/enroute/examples/eval/test
test $ vi src/main/java/osgi/enroute/examples/eval/test/EvalTest.java
// get the content from the next section
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">osgi</span><span class="o">.</span><span class="na">enroute</span><span class="o">.</span><span class="na">examples</span><span class="o">.</span><span class="na">eval</span><span class="o">.</span><span class="na">test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.osgi.framework.BundleContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.framework.FrameworkUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.framework.ServiceReference</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">junit.framework.TestCase</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">osgi.enroute.examples.eval.api.Eval</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EvalTest</span>  <span class="kd">extends</span> <span class="n">TestCase</span> <span class="o">{</span>
	<span class="n">BundleContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">FrameworkUtil</span><span class="o">.</span><span class="na">getBundle</span><span class="o">(</span><span class="n">EvalTest</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">getBundleContext</span><span class="o">();</span>
	
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testEval</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
		<span class="n">ServiceReference</span><span class="o">&lt;</span><span class="n">Eval</span><span class="o">&gt;</span> <span class="n">ref</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getServiceReference</span><span class="o">(</span><span class="n">Eval</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">assertNotNull</span><span class="o">(</span><span class="s">"No such service"</span><span class="o">,</span> <span class="n">ref</span><span class="o">);</span>
		<span class="n">Eval</span> <span class="n">eval</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getService</span><span class="o">(</span><span class="n">ref</span><span class="o">);</span>
		<span class="n">assertNotNull</span><span class="o">(</span><span class="s">"Service object init error"</span><span class="o">,</span> <span class="n">eval</span><span class="o">);</span>
		<span class="n">assertEquals</span><span class="o">(</span> <span class="mf">7.0</span><span class="n">D</span><span class="o">,</span> <span class="n">eval</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">"1+6"</span><span class="o">));</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Remember that the bnd runtime support for testing expects the Test-Cases manifest
header to be set. We therefore need a bnd.bnd file.</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test $ vi bnd.bnd
// get the content from the next section
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Bundle-Description: 				\
	Integration Test bundle for the Eval service

Test-Cases: ${classes;NAMED;*Test}
</code></pre></div></div>

<p>The magic in this case is the macro <code class="highlighter-rouge">classes</code>. It will list all classes that
end with <code class="highlighter-rouge">Test</code>.</p>

<h2 id="install">Install</h2>

<p>That’s all, we created a test bundle. So we need to install it.</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test $ mvn install
...
</code></pre></div></div>

<p>You should also add this project to our parent pom.</p>

<h2 id="the-integration-test-project">The Integration Test Project</h2>

<p>Integration testing requires a runtime environment. We have been using the 
bndrun file to create a runtime environment for our application. We can use a
similar bndrun file, or more than one, to perform our integration tests.</p>

<p>Multiple environments can be useful if you want to test on different platforms.</p>

<h2 id="create-the-integration-project-and-pom">Create the Integration Project and Pom</h2>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test $ cd ..
osgi.enroute.examples.eval $ mkdir integration-test
osgi.enroute.examples.eval $ cd integration-test
integration-test $ vi pom.xml
// get content from next section
</code></pre></div></div>

<p>The content of our pom is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;project 
	xmlns="http://maven.apache.org/POM/4.0.0" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

	&lt;parent&gt;
		&lt;groupId&gt;org.osgi&lt;/groupId&gt;
		&lt;artifactId&gt;osgi.enroute.examples.eval&lt;/artifactId&gt;
		&lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
		&lt;relativePath&gt;..&lt;/relativePath&gt;
	&lt;/parent&gt;

	&lt;artifactId&gt;osgi.enroute.examples.eval.integration-test&lt;/artifactId&gt;

	&lt;packaging&gt;pom&lt;/packaging&gt;

	&lt;build&gt;
		&lt;plugins&gt;
</code></pre></div></div>

<p>This plugin will iterate over a set of bndrun files and execute any tests in them.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>			&lt;plugin&gt;
				&lt;groupId&gt;biz.aQute.bnd&lt;/groupId&gt;
				&lt;artifactId&gt;bnd-testing-maven-plugin&lt;/artifactId&gt;
				&lt;version&gt;3.4.0-SNAPSHOT&lt;/version&gt;
				&lt;configuration&gt;
					&lt;resolve&gt;true&lt;/resolve&gt;
					&lt;bndruns&gt;
</code></pre></div></div>

<p>The relative file path of the bndrun file. We will create a runtime that has
the parsii provider for testing.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>						&lt;bndrun&gt;parsii.bndrun&lt;/bndrun&gt;
						
					&lt;/bndruns&gt;
					&lt;targetDir&gt;.&lt;/targetDir&gt;
				&lt;/configuration&gt;
				&lt;executions&gt;
					&lt;execution&gt;
						&lt;goals&gt;
							&lt;goal&gt;testing&lt;/goal&gt;
						&lt;/goals&gt;
					&lt;/execution&gt;
				&lt;/executions&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;
</code></pre></div></div>

<p>To be able to resolve our own projects we need to list the dependencies we are
allowed to resolve against.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.osgi&lt;/groupId&gt;
			&lt;artifactId&gt;osgi.enroute.examples.eval.parsii.provider&lt;/artifactId&gt;
			&lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.osgi&lt;/groupId&gt;
			&lt;artifactId&gt;osgi.enroute.examples.eval.test&lt;/artifactId&gt;
			&lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.osgi&lt;/groupId&gt;
			&lt;artifactId&gt;osgi.enroute.pom.distro&lt;/artifactId&gt;
			&lt;version&gt;2.0.0&lt;/version&gt;
		&lt;/dependency&gt;
		
	&lt;/dependencies&gt;
&lt;/project&gt;
</code></pre></div></div>

<h2 id="the-parsiibndrun-file">The parsii.bndrun File</h2>

<p>In the <code class="highlighter-rouge">bndruns</code> section of the bnd-testing-maven-plugin we listed the <code class="highlighter-rouge">parsii.bndrun</code> file.
We therefore need to create it:</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>integration-test $ vi parsii.bndrun
// get the content of the next section
</code></pre></div></div>

<p>The content is quite similar to the bndrun file we created in the bndrun project.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-standalone: 

-plugin.examples.eval = \
	aQute.bnd.repository.maven.pom.provider.BndPomRepository; \
		snapshotUrls=https://oss.sonatype.org/content/repositories/osgi/; \
		releaseUrls=https://repo1.maven.org/maven2/; \
		pom=${.}/pom.xml; \
		name=examples.eval; \
		location=${.}/target/cached.xml
</code></pre></div></div>

<p>We want to test the parsii provider.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-runrequires: \
	osgi.identity;filter:='(osgi.identity=osgi.enroute.examples.eval.parsii.provider)',\
	osgi.identity;filter:='(osgi.identity=osgi.enroute.examples.eval.test)'

-runfw: 		org.eclipse.osgi;version='[3.10.100.v20150529-1857,3.10.100.v20150529-1857]'
-runtrace: 		true


-runee: 						JavaSE-1.8
-resolve.effective:				resolve, active
	
-runsystempackages.eqnx:		javax.script
-runsystemcapabilities.dflt: 	${native_capability}
</code></pre></div></div>

<p>Just like the bndrun file before, we need to resolve the file to find the bundles.</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>integration-test $ mvn install
...
</code></pre></div></div>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-runbundles: \
	org.apache.felix.configadmin; version='[1.8.8,1.8.9)',\
	org.apache.felix.scr; version='[2.0.2,2.0.3)',\
	org.eclipse.equinox.metatype; version='[1.4.100,1.4.101)',\
	org.osgi.service.metatype; version='[1.3.0,1.3.1)',\
	osgi.enroute.examples.eval.parsii.provider; version='[1.0.0,1.0.1)',\
	osgi.enroute.examples.eval.test; version='[1.0.0,1.0.1)',\
	osgi.enroute.hamcrest.wrapper; version='[1.3.0,1.3.1)',\
	osgi.enroute.junit.wrapper; version='[4.12.0,4.12.1)'

integration-test $ vi parsii.bndrun
// update the -runbundles	
integration-test $ mvn install
...
Test parsii.bndrun
Tests run  : 1
Passed     : 1
Errors     : 0
Failures   : 0
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
...
</code></pre></div></div>

<h2 id="what-did-we-learn">What Did We Learn?</h2>

<p>In this section we created an OSGi integration test. This required a test bundle
that had the Test-Cases manifest header set. It also required an integration-test
project that ran the test. This project can run multiple integration tests by
defining multiple bndrun files and listing them in the configuration section
of the bnd-testing-maven-plugin.</p>


		    </div>
			<div class="col hide-on-med-and-down l2">
				<div id="toc-wrapper" class="toc-wrapper pin-top">
				  <ul id="toc" class="section table-of-contents">
					
				  </ul>
				</div>
			</div>
			
			
				
				<div class="col s6 left-align hide-on-large-only show-on-med-and-down"><a href="web.html"><i class="large material-icons">keyboard_arrow_left</i></a></div>
			
			
				<div class="col s6  right-align hide-on-large-only show-on-med-and-down"><a href="modules.html"><i class="large material-icons">keyboard_arrow_right</i></a></div>
			
			
			
				<div class="prev-nav hide-on-med-and-down"><a href="web.html"><i class="small material-icons">keyboard_arrow_left</i></a></div>
			
			
				<div class="next-nav hide-on-med-and-down"><a href="modules.html"><i class="small material-icons">keyboard_arrow_right</i></a></div>
			
		
			
    </div> 
	
  </div>
  </main>
	<footer class="page-footer">
    <!--<div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5>Lorem Ipsum</h5>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        </div>
      </div>
    </div>-->
    <div class="footer-copyright">
        <div class="container">
            <div>
				<span style="text-align: left; float: left; width: 30%;">
				Made with <a target="_blank" href="http://materializecss.com">Materialize</a>
				</span>
				<span style="text-align: center; float: left; width: 40%;">
				Copyright © 2018 <a href="https://www.osgi.org/">Thomas Driessen</a>
				</span>
                <span style="text-align: right; float: left; width: 30%;">
				Powered by <a target="_blank" href="http://jekyllrb.com/">Jekyll</a>
                </span>
            </div>
        </div>
    </div>
</footer>      
	<!--  Scripts-->  

<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/materialize.min.js"></script>
<script src="/assets/js/init.js"></script>	
	<script src="/assets/js/content.js"></script>	
  </body>

</html>