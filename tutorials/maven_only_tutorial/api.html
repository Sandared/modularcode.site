<!DOCTYPE html>
<html lang="en"><head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
    <title>API Project</title>
    <meta name="description" content="API Project" />
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen,projection" href="/assets/materialize.css" />
    <link rel="canonical" href="http://localhost:4000/tutorials/maven_only_tutorial/api.html" />
    <link rel="alternate" type="application/rss+xml" title="modularcode" href="/feed.xml" />
    
</head>
<!-- Is it a content or a nested page -->
	
	
	
	<style>a {color: #757575;fill:#424242;}a:hover {color: #03a9f4;fill:#03a9f4;}h1,h2,h3,h4,h5,h6{color: #424242;}body{color: #212121; display: flex; min-height: 100vh; flex-direction: column;}nav ul a{color: #424242;}nav .brand-logo{color: #424242}.justify-align{text-align:justify;}nav a{color: #424242;}main{flex: 1 0 auto;}.side-nav li>a{color: #424242;}.side-nav .collapsible-header, .side-nav.fixed .collapsible-header{padding-left:32px;}.side-nav .collapsible-body li a, .side-nav.fixed .collapsible-body li a{padding-left:47px;}h1,h2,h3,h4,h5,h6{-webkit-font-smoothing: antialiased;}.icon-block{padding: 0 15px;}.icon-block .material-icons{font-size: inherit;}.row{margin-bottom:0px;}.logo img{padding-top:3px;}.page-footer{background-color:#03a9f4; padding-top: 0px;}.nav-button{width:20px; height:20px; viewBox:0 0 20 20;}footer h5{color:#FFFFFF;}hr{background-color:#bdbdbd;}.divider{background-color:#bdbdbd;}img{max-width: 100%; height: auto;}.page-footer .footer-copyright{background-color:#03a9f4;}/* Code Highlighting */.highlight .c { color: #bdbdbd; font-style: italic } /* Comment */.highlight .k { color: #212121; font-weight: bold } /* Keyword */.highlight .cm { color: #bdbdbd; font-style: italic } /* Comment.Multiline */.highlight .c1 { color: #bdbdbd; font-style: italic } /* Comment.Single */.highlight .kc { color: #424242; font-weight: bold } /* Keyword.Constant */.highlight .kd { color: #212121; font-weight: bold } /* Keyword.Declaration */.highlight .kn { color: #424242; font-weight: bold } /* Keyword.Namespace */.highlight .kp { color: #424242; font-weight: bold } /* Keyword.Pseudo */.highlight .kr { color: #424242; font-weight: bold } /* Keyword.Reserved */.highlight .kt { color: #424242; font-weight: bold } /* Keyword.Type */.highlight .s { color: #757575 } /* Literal.String */.highlight .n { color: #03a9f4 } /* Name */.highlight .na { color: #03a9f4 } /* Name.Attribute */.highlight .nc { color: #03a9f4} /* Name.Class */.highlight .nd { color: #757575 } /* Name.Decorator */.highlight .nf { color: #03a9f4 } /* Name.Function */.highlight .mf { color: #757575 } /* Literal.Number.Float */.highlight .mh { color: #757575 } /* Literal.Number.Hex */.highlight .mi { color: #757575 } /* Literal.Number.Integer */.highlight .mo { color: #757575 } /* Literal.Number.Oct */.highlight .sb { color: #757575 } /* Literal.String.Backtick */.highlight .sc { color: #757575 } /* Literal.String.Char */.highlight .sd { color: #757575 } /* Literal.String.Doc */.highlight .s2 { color: #757575 } /* Literal.String.Double */.highlight .se { color: #757575 } /* Literal.String.Escape */.highlight .sh { color: #757575 } /* Literal.String.Heredoc */.highlight .si { color:#757575 } /* Literal.String.Interpol */.highlight .sx { color: #757575 } /* Literal.String.Other */.highlight .sr { color: #757575 } /* Literal.String.Regex */.highlight .s1 { color: #757575 } /* Literal.String.Single */.highlight .ss { color: #757575 } /* Literal.String.Symbol */.highlight {tab-size: 4;}div.highlighter-rouge{padding:5px;background:#f5f5f5;border:1px solid #bdbdbd;border-radius:4px;}div.highlight pre.highlight{margin:0px;}code.highlighter-rouge{padding:0px 3px;background:#f5f5f5;border:1px solid #bdbdbd;border-radius:3px;}/* Make headers a little bit smaller */h1{font-size:2.8rem;}h2{font-size:2.5rem;}h3{font-size:2.1rem;}h4{font-size:1.8rem;}h5{font-size:1.3rem;}h6{font-size:1rem;}/* Plain text */p{text-align:justify;}/* Blockquotes */blockquote{border-left:3px solid #03a9f4;font-style:italic;font-weight:300;}/* Tables */table.striped>tbody>tr:nth-child(odd){background-color:#f5f5f5;}/* Cards */.card .card-image .card-title{color: #212121; font-weight: 600; padding-bottom: 0px; padding-left:12px; padding-right: 12px;}.card-content{color: #757575;}.card .card-content{padding-top: 5px;}.card .card-action a:not(.btn):not(.btn-large):not(.btn-large):not(.btn-floating){color: #424242;}.card .card-action a:not(.btn):not(.btn-large):not(.btn-large):not(.btn-floating):hover{color: #03a9f4;}.card.small{height: 225px;}.card-placeholder-image{color:#bdbdbd;}.card-image img{opacity: 0.3;}.card-image h2{opacity: 0.3;}.card .card-image{min-height:60%;}/* Breadcrumbs */nav{background-color: #FFFFFF;}a.breadcrumb{color: #757575;}.breadcrumb:last-child{color:#03a9f4;}.breadcrumb:before{color:#757575;font-size:15px;}nav.breadcrumbs{box-shadow:none;margin-top:4px;}ul.collapsible{list-style-type: none;padding:0px;}.collapsible-header{border-bottom:0px;}.collapsible-body{padding:5px;}/* Table of Contents */.second-level{padding:0px;}.table-of-contents .second-level a{padding-left:40px;font-size:13px;}.table-of-contents a{color:#757575;}.table-of-contents a:hover{border-left:1px solid #03a9f4;color:#03a9f4;}.table-of-contents a.active{border-left:2px solid #03a9f4;color:#757575;}.toc-wrapper li{padding:1px;}/* Navigation Arrows */.prev-nav{top: 50%;left: 3%;position:fixed;}.next-nav{top: 50%;right: 3%;position:fixed;}</style>

  <body>
	<!-- Navigation Header -->
	<nav class="white lighten-1" role="navigation">
	<div class="nav-wrapper container">
		<a id="logo-container" class="brand-logo logo show-on-medium-and-up hide-on-small-only" href="/"><img src="/logo.png"></a>
		<a id="logo-container" class="brand-logo logo show-on-small hide-on-med-and-up" href="/"><img src="/logo-small.png"></a>
	  
	  
	
	  <ul class="right hide-on-med-and-down">
		
			
			<li><a href="/tutorials.html">Tutorials</a></li>
		
			
			<li><a href="/modules.html">Modules</a></li>
		
			
			<li><a href="/projects.html">Projects</a></li>
		
			
			<li><a href="/contribute.html">Contribute</a></li>
		
		
			<li>
				<a title="modularcode.site on GitHub" href="https://github.com/Sandared/modularcode.site"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>github</title>
						<path d="M10 0C4.477 0 0 4.477 0 10c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.342-3.369-1.342-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.268 2.75 1.026A9.578 9.578 0 0 1 10 4.836c.85.004 1.705.114 2.504.337 1.909-1.294 2.747-1.026 2.747-1.026.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.579.688.481C17.137 18.163 20 14.418 20 10c0-5.523-4.478-10-10-10" fill-rule="evenodd">
						</path>
					</svg>					
				</a>
			</li>
		
		
		
			<li>
				<a title="SanfteSchorle on Twitter" href="https://twitter.com/SanfteSchorle"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>twitter</title>
						<path d="M15.115 7.788c.005.11.009.223.009.335 0 3.43-2.611 7.384-7.386 7.384-1.467 0-2.831-.43-3.98-1.166a5.244 5.244 0 0 0 3.843-1.075 2.596 2.596 0 0 1-2.424-1.801 2.645 2.645 0 0 0 1.171-.045 2.597 2.597 0 0 1-2.082-2.544v-.033c.351.194.752.311 1.177.324a2.59 2.59 0 0 1-1.154-2.16c0-.475.127-.92.35-1.305A7.37 7.37 0 0 0 9.99 8.414a2.596 2.596 0 0 1 4.423-2.367 5.174 5.174 0 0 0 1.648-.63 2.602 2.602 0 0 1-1.142 1.436 5.17 5.17 0 0 0 1.491-.41 5.233 5.233 0 0 1-1.295 1.345M10 0C4.486 0 0 4.486 0 10s4.486 10 10 10 10-4.486 10-10S15.514 0 10 0" fill-rule="evenodd">
						</path>
					</svg>			
				</a>
			</li>
		
	  </ul>

	  <ul id="nav-mobile" class="side-nav">
		<li><a href="http://localhost:4000">Home</a></li>
		<li class="divider"></li>
		
			
			<li><a href="/tutorials.html">Tutorials</a></li>
			<li class="divider"></li>
		
			
			<li><a href="/modules.html">Modules</a></li>
			<li class="divider"></li>
		
			
			<li><a href="/projects.html">Projects</a></li>
			<li class="divider"></li>
		
			
			<li><a href="/contribute.html">Contribute</a></li>
			<li class="divider"></li>
		
		
			<li>
				<a title="modularcode.site on GitHub" href="https://github.com/Sandared/modularcode.site"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>github</title>
						<path d="M10 0C4.477 0 0 4.477 0 10c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.342-3.369-1.342-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.268 2.75 1.026A9.578 9.578 0 0 1 10 4.836c.85.004 1.705.114 2.504.337 1.909-1.294 2.747-1.026 2.747-1.026.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.579.688.481C17.137 18.163 20 14.418 20 10c0-5.523-4.478-10-10-10" fill-rule="evenodd">
						</path>
					</svg>					
				</a>
			</li>
			<li class="divider"></li>
		
		
		
			<li>
				<a title="SanfteSchorle on Twitter" href="https://twitter.com/SanfteSchorle"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>twitter</title>
						<path d="M15.115 7.788c.005.11.009.223.009.335 0 3.43-2.611 7.384-7.386 7.384-1.467 0-2.831-.43-3.98-1.166a5.244 5.244 0 0 0 3.843-1.075 2.596 2.596 0 0 1-2.424-1.801 2.645 2.645 0 0 0 1.171-.045 2.597 2.597 0 0 1-2.082-2.544v-.033c.351.194.752.311 1.177.324a2.59 2.59 0 0 1-1.154-2.16c0-.475.127-.92.35-1.305A7.37 7.37 0 0 0 9.99 8.414a2.596 2.596 0 0 1 4.423-2.367 5.174 5.174 0 0 0 1.648-.63 2.602 2.602 0 0 1-1.142 1.436 5.17 5.17 0 0 0 1.491-.41 5.233 5.233 0 0 1-1.295 1.345M10 0C4.486 0 0 4.486 0 10s4.486 10 10 10 10-4.486 10-10S15.514 0 10 0" fill-rule="evenodd">
						</path>
					</svg>			
				</a>
			</li>
			<li class="divider"></li>
		
	  </ul>        

	  <a data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
	</div>
</nav>
	
	
	
  <main>	
  <div class="container">
		<div class="row">	
		
			<div id="text-content" class="section col s12 l10">
				


<nav class="breadcrumbs">
	<div class="nav-wrapper">
	
	
		
	
		
			
			
			
			
			
							
				
				
							
				
				
							
				
				
			
				
					
					<a href="http://localhost:4000/tutorials.html" class="breadcrumb">Tutorials</a>
				
			
		
	
		
			
			
			
			
			
							
				
				
							
				
				
							
				
				
					
				
				<a href="http://localhost:4000/tutorials/maven_only_tutorial.html" class="breadcrumb">Maven ONLY Tutorial</a>
				
			
		
	
		
			
			
			
			
			
							
				
				
							
				
				
							
				
				
					
				
				<a href="http://localhost:4000/tutorials/maven_only_tutorial/api.html" class="breadcrumb">API Project</a>
				
			
		
	
	</div>
</nav>

				<h1 id="api-project">API Project</h1>

<h2 id="what-you-will-learn-in-this-section">What you will learn in this section</h2>
<p>In this section we are going to create an API for a simple expression evaluator. 
It will teach you how to create an API project, how to name a project, and how to 
navigate around in the project. We also explain how to version packages.</p>

<p><img src="img/api-diagram.png" alt="API Diagram" /></p>

<p>Make sure you are in the top directory:</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd ~/workspaces/osgi.enroute.examples.eval
</code></pre></div></div>

<h2 id="creating-a-pom">Creating a POM</h2>

<p>You should create a directory <code class="highlighter-rouge">api</code> in the <code class="highlighter-rouge">osgi.enroute.examples.eval</code> directory. In this
directory we create a <code class="highlighter-rouge">pom.xml</code>.</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>osgi.enroute.examples.eval $ mkdir api
osgi.enroute.examples.eval $ cd api
api $ vi pom.xml
// fill in the content from the next sections
</code></pre></div></div>

<p>This POM should look like:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project</span> 
	<span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> 
	<span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>
<span class="nt">&gt;</span>
	<span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
</code></pre></div></div>

<p>Define the parent pom, we inherit lots of information from
that POM.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	&lt;parent&gt;
		&lt;groupId&gt;org.osgi&lt;/groupId&gt;
		&lt;artifactId&gt;osgi.enroute.examples.eval&lt;/artifactId&gt;
		&lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
	&lt;/parent&gt;
</code></pre></div></div>

<p>We inherit the version and group Id from our parent POM so we only have to specify
the artifact Id. The artifact Id will also act as the Bundle Symbolic Name. In OSGi enRoute
the following (highly recommended) conventions are advised for the last segment of the
artifact Id name:</p>

<ul>
  <li><code class="highlighter-rouge">.api</code> – API only project</li>
  <li><code class="highlighter-rouge">.provider</code>, <code class="highlighter-rouge">adapter</code> – An implementation project</li>
  <li><code class="highlighter-rouge">.application</code> – An application project. This is a project that binds together a set of components and parameterizes them.</li>
  <li><code class="highlighter-rouge">.test</code> – An OSGi test project, tests are run inside a framework.</li>
</ul>

<p>The name of the bundle</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	&lt;artifactId&gt;osgi.enroute.examples.eval.api&lt;/artifactId&gt;
</code></pre></div></div>

<p>This bundle generates a JAR that contains the API code with the OSGi metadata. We therefore need
to package it as a JAR.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	&lt;packaging&gt;jar&lt;/packaging&gt;
</code></pre></div></div>

<p>Documentation is always desired:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	&lt;description&gt;Eval API&lt;/description&gt;
	
&lt;/project&gt;
</code></pre></div></div>

<p>Verify your pom by running <code class="highlighter-rouge">mvn verify</code>.</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>api $ mvn verify
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
...
</code></pre></div></div>

<h2 id="the-source">The Source</h2>

<p>We want to make a component that evaluates expressions. We first define the contract. 
The service contract for now could be an interface. Define the following in the
<code class="highlighter-rouge">src/main/java/osgi/enroute/examples/eval/Eval.java</code> file in the <code class="highlighter-rouge">osgi.enroute.examples.eval/api</code> directory.</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>api $ mkdir -p src/main/java/osgi/enroute/examples/eval/api
api $ vi src/main/java/osgi/enroute/examples/eval/api/Eval.java
// fill in the content from the next section
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">osgi</span><span class="o">.</span><span class="na">enroute</span><span class="o">.</span><span class="na">examples</span><span class="o">.</span><span class="na">eval</span><span class="o">.</span><span class="na">api</span><span class="o">;</span>
<span class="cm">/**
 * A service that evaluates an expression and returns the result
 */</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Eval</span> <span class="o">{</span>
	<span class="cm">/**
	 * Evaluate an expression and return the result.
	 */</span>
	<span class="kt">double</span> <span class="nf">eval</span><span class="o">(</span><span class="n">String</span> <span class="n">expression</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="versioning">Versioning</h2>

<p>In OSGi packages that are shared between bundles have a <em>version</em>. Though this
sounds horrendously complex for a developer that are used to the Maven version
chores, rest assured. The bnd maven plugin significantly simplifies version handling.</p>

<p>We therefore need to put a file in the package directory that contains the version.
We use an annotation on the package for this. Therefore, create a file <code class="highlighter-rouge">package-info.java</code>
with the following content in the package directory:</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>api $ vi src/main/java/osgi/enroute/examples/eval/api/package-info.java
// fill in the content from the next section
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@org</span><span class="o">.</span><span class="na">osgi</span><span class="o">.</span><span class="na">annotation</span><span class="o">.</span><span class="na">versioning</span><span class="o">.</span><span class="na">Version</span><span class="o">(</span><span class="s">"1.0.0"</span><span class="o">)</span>
<span class="kn">package</span> <span class="n">osgi</span><span class="o">.</span><span class="na">enroute</span><span class="o">.</span><span class="na">examples</span><span class="o">.</span><span class="na">eval</span><span class="o">.</span><span class="na">api</span><span class="o">;</span>
</code></pre></div></div>

<p>The bnd plugin will pickup this version and add it to the manifest when the
package is exported. You should change the version when you make changes to the
package content.</p>

<h2 id="semantic-versioning">Semantic Versioning</h2>

<p>The OSGi strongly recommends <em>semantic versioning</em>. The rules for semantic versioning
prescribe what part of the version to change based on compatibility. Semantic version
is very important for package version and you should strictly follow them. (There is
a plugin that can verify when you violate the rules based on Java’s binary compatibility
model.)</p>

<p>A version consists of 4 parts in OSGi:</p>

<ul>
  <li>Major – The first number. If it is changed between releases it indicates that it is incompatible with the previous release.</li>
  <li>Minor – The second number. If it is changed between releases it indicates that <em>providers</em> are broken but <em>consumers</em> are compatible.</li>
  <li>Micro – The third number. If it is changed between releases  it means that there is no binary nor semantic change, for example an improved comment.</li>
  <li>Qualifier – The last segment. This is normally changed between builds.</li>
</ul>

<h3 id="provider--consumer-types">Provider &amp; Consumer Types</h3>

<p>In this API, any party that will implement the <code class="highlighter-rouge">Eval</code> interface is considered to be 
the <em>provider</em>. A provider must fully implement a contract that has virtually no 
backward compatibility unlike <em>consumers</em> of this API. Any change in the version 
that affects the public API must result in  rebuild of the provider’s bundle. That 
is, if our version here goes to 1.1 we want to make sure our providers that implemented 
1.0 are no longer compatible.</p>

<p>Obviously it is a nightmare to ensure that the proper version ranges are used. We can 
significantly help the provider by adding an annotation to this interface:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.osgi.annotation.versioning.ProviderType</span><span class="o">;</span>

<span class="nd">@ProviderType</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Eval</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</code></pre></div></div>

<p>The bnd tool will now automatically ensure that any <em>implementers</em> of this interface 
use semantic versioning to import the package with a minor range, for example <code class="highlighter-rouge">[1.0,1.1)</code>
because they are deemed a provider.</p>

<p>Interfaces that are implemented by the consumer of your API (usually listener like interfaces) 
can be annotated with the <code class="highlighter-rouge">@ConsumerType</code> annotation. However, this is the default.</p>

<p>If you find this hard to grasp then you’re not alone. This is a very complex area. We 
will get back to this later so don’t worry if you do not immediately grasp it.</p>

<h2 id="the-bnd-file">The bnd File</h2>

<p>The bnd plugin provides the OSGi metadata and keeps us honest. The plugin, defined in the parent POM, 
requires a bnd.bnd file in the same directory as the POM. In our case, we provide 
the API we should therefore export the package.</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>api $ vi bnd.bnd
// fill in content from next section
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#
# OSGi enRoute Examples Eval API Project
#

Bundle-Description: 				\
	An API for an expression parser

Require-Capability: \
	compile-only

Export-Package: osgi.enroute.examples.eval.api
</code></pre></div></div>

<p>A <code class="highlighter-rouge">bnd.bnd</code> file is a properties file, same rules apply. Comments can be added 
by starting a line with a hash mark (<code class="highlighter-rouge">#</code>). The first word on the line is the key and
then a space, a ‘:’ or ‘=’ marks the separator. The rest is the value minus any leading
spaces.</p>

<p>Keys that start with an upper case character are added to the manifest, other
keys are macros and can be used anywhere with the <code class="highlighter-rouge">${key}</code> syntax.</p>

<p>The Bundle-Description key should be self describing.</p>

<h3 id="compile-only">Compile Only</h3>

<p>If you look in the <code class="highlighter-rouge">bnd.bnd</code> file you see that this API bundle is compile only:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Require-Capability: \
	compile-only
</code></pre></div></div>

<p>The reason this is compile only is that best practices dictate that the provider 
should export its API. There have been numerous discussions about this and some opinions 
differ. However, a provider of an API is extremely closely tied to the version of the 
API it provides. Virtually any change in the API requires a change in the provider, 
there is no backward compatibility as there is for the API consumers. Therefore, by 
exporting the API from the provider you make the whole system less complex.</p>

<h3 id="export">Export</h3>

<p>All packages in the project are automatically added to the bundle. By default, these packages are private.
The Export-Package header tells bnd to add the export header for the <code class="highlighter-rouge">osgi.enroute.examples.eval.api</code> package.</p>

<h2 id="building">Building</h2>

<p>Our <code class="highlighter-rouge">osgi.enroute.examples.eval/api</code> directory should look as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bnd.bnd
pom.xml
src/main/java/osgi/enroute/examples/eval/api/package-info.java
src/main/java/osgi/enroute/examples/eval/api/Eval.java
</code></pre></div></div>

<p>You might have a <code class="highlighter-rouge">target</code> directory, this is where maven stores temporary files. To update/create the
target we run <code class="highlighter-rouge">mvn install</code> again.</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>api $ mvn install
...
api $ ls -1 target
classes
generated-sources
maven-archiver
maven-status
osgi.enroute.examples.eval.api-1.0.0-SNAPSHOT.jar
</code></pre></div></div>

<p>There are some additional files in the target directory. Since we did an install, we also copied the JAR to
the Maven local repository in <code class="highlighter-rouge">~/.m2/repository/org/osgi/osgi.enroute.examples.eval.api/1.0.0-SNAPSHOT/osgi.enroute.examples.eval.api-1.0.0-SNAPSHOT.jar</code>.</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>api $ ls ~/.m2/repository/org/osgi/osgi.enroute.examples.eval.api/1.0.0-SNAPSHOT/osgi.enroute.examples.eval.api-1.0.0-SNAPSHOT.jar
~/.m2/repository/org/osgi/osgi.enroute.examples.eval.api/1.0.0-SNAPSHOT/osgi.enroute.examples.eval.api-1.0.0-SNAPSHOT.jar
</code></pre></div></div>

<p>If we have bnd installed as command line tool then you can take a look at the manifest:</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ bnd print target/osgi.enroute.examples.eval.api-1.0.0-SNAPSHOT.jar 
[MANIFEST osgi.enroute.examples.eval.api-1.0.0-SNAPSHOT]
Bnd-LastModified                         1474982517123                           
Build-Jdk                                1.8.0_25                                
Built-By                                 aqute                                   
Bundle-Description                       An API for an expression parser         
Bundle-ManifestVersion                   2                                       
Bundle-Name                              osgi.enroute.examples.eval.api           
Bundle-SymbolicName                      osgi.enroute.examples.eval.api           
Bundle-Version                           1.0.0.201609271321                      
Created-By                               1.8.0_25 (Oracle Corporation)           
Export-Package                           osgi.enroute.examples.eval.api;version="1.0.0"
Manifest-Version                         1.0                                     
Require-Capability                       compile-only,osgi.ee;filter:="(&amp;(osgi.ee=JavaSE)(version=1.8))"
Tool                                     Bnd-3.3.0.201609221906                  

[IMPEXP]
Export-Package
  osgi.enroute.examples.eval.api          {version=1.0.0}
</code></pre></div></div>

<p>You can printout more by using the print options that you can see with <code class="highlighter-rouge">bnd help print</code>.</p>

<h2 id="how-does-it-work">How does it Work?</h2>

<p>When we run maven the bnd plugin will analyze the class files and use the information
that is inside these files, which includes the annotations, to generate a manifest. The
bnd tool has a lot of OSGi knowledge embedded and it can find many errors and warnings
to signal ideas that are not such a good idea.</p>

<p>The plugin places the manifest and other files in the <code class="highlighter-rouge">target/classes</code> directory. This
directory is then made into a JAR by the Maven jar plugin.</p>

<p>In M2Eclipse, the bnd plugin runs after every change but the JAR plugin does not. So the classes
directory is updated but not the JAR. You need to run <code class="highlighter-rouge">maven install</code> to create the JAR in
the local repository.</p>

<h2 id="what-have-we-done">What Have We Done?</h2>

<p>You’ve just created your first bundle with maven! We’ve created a service API bundle that
we can use in other projects to compile against but it cannot be used in
runtime.</p>

<p>We spent some effort on learning the semantic versioning rules and how to provide
package versions in OSGi.</p>


		    </div>
			<div class="col hide-on-med-and-down l2">
				<div id="toc-wrapper" class="toc-wrapper pin-top">
				  <ul id="toc" class="section table-of-contents">
					
				  </ul>
				</div>
			</div>
			
			
				
				<div class="col s6 left-align hide-on-large-only show-on-med-and-down"><a href="parent.html"><i class="large material-icons">keyboard_arrow_left</i></a></div>
			
			
				<div class="col s6  right-align hide-on-large-only show-on-med-and-down"><a href="provider.html"><i class="large material-icons">keyboard_arrow_right</i></a></div>
			
			
			
				<div class="prev-nav hide-on-med-and-down"><a href="parent.html"><i class="small material-icons">keyboard_arrow_left</i></a></div>
			
			
				<div class="next-nav hide-on-med-and-down"><a href="provider.html"><i class="small material-icons">keyboard_arrow_right</i></a></div>
			
		
			
    </div> 
	
  </div>
  </main>
	<footer class="page-footer">
    <!--<div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5>Lorem Ipsum</h5>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        </div>
      </div>
    </div>-->
    <div class="footer-copyright">
        <div class="container">
            <div>
				<span style="text-align: left; float: left; width: 30%;">
				Made with <a target="_blank" href="http://materializecss.com">Materialize</a>
				</span>
				<span style="text-align: center; float: left; width: 40%;">
				Copyright © 2018 <a href="https://twitter.com/SanfteSchorle">Thomas Driessen</a>
				</span>
                <span style="text-align: right; float: left; width: 30%;">
				Powered by <a target="_blank" href="http://jekyllrb.com/">Jekyll</a>
                </span>
            </div>
        </div>
    </div>
</footer>      
	<!--  Scripts-->  

<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/materialize.min.js"></script>
<script src="/assets/js/init.js"></script>	
	<script src="/assets/js/content.js"></script>	
  </body>

</html>