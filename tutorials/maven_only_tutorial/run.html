<!DOCTYPE html>
<html lang="en"><head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
    <title>OSGi Runtime</title>
    <meta name="description" content="OSGi Runtime" />
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen,projection" href="/assets/materialize.css" />
    <link rel="canonical" href="http://localhost:4000/tutorials/maven_only_tutorial/run.html" />
    <link rel="alternate" type="application/rss+xml" title="modularcode" href="/feed.xml" />
    
</head>
<!-- Is it a content or a nested page -->
	
	
	
	<style>a {color: #757575;fill:#424242;font-weight:450;}a:hover {color: #03a9f4;fill:#03a9f4;}h1,h2,h3,h4,h5,h6{color: #424242;}body{color: #212121; display: flex; min-height: 100vh; flex-direction: column;}nav ul a{color: #424242;}nav .brand-logo{color: #424242}.justify-align{text-align:justify;}nav a{color: #424242;}main{flex: 1 0 auto;}.side-nav li>a{color: #424242;}.side-nav .collapsible-header, .side-nav.fixed .collapsible-header{padding-left:32px;}.side-nav .collapsible-body li a, .side-nav.fixed .collapsible-body li a{padding-left:47px;}h1,h2,h3,h4,h5,h6{-webkit-font-smoothing: antialiased;}.icon-block{padding: 0 15px;}.icon-block .material-icons{font-size: inherit;}.row{margin-bottom:0px;}.logo img{padding-top:3px;}.page-footer{background-color:#03a9f4; padding-top: 0px;}.nav-button{width:20px; height:20px; viewBox:0 0 20 20;}footer h5{color:#FFFFFF;}hr{background-color:#bdbdbd;}.divider{background-color:#bdbdbd;}img{max-width: 100%; height: auto;}.page-footer .footer-copyright{background-color:#03a9f4;}/* Code Highlighting */.highlight .c { color: #bdbdbd; font-style: italic } /* Comment */.highlight .k { color: #212121; font-weight: bold } /* Keyword */.highlight .cm { color: #bdbdbd; font-style: italic } /* Comment.Multiline */.highlight .c1 { color: #bdbdbd; font-style: italic } /* Comment.Single */.highlight .kc { color: #424242; font-weight: bold } /* Keyword.Constant */.highlight .kd { color: #212121; font-weight: bold } /* Keyword.Declaration */.highlight .kn { color: #424242; font-weight: bold } /* Keyword.Namespace */.highlight .kp { color: #424242; font-weight: bold } /* Keyword.Pseudo */.highlight .kr { color: #424242; font-weight: bold } /* Keyword.Reserved */.highlight .kt { color: #424242; font-weight: bold } /* Keyword.Type */.highlight .s { color: #757575 } /* Literal.String */.highlight .n { color: #03a9f4 } /* Name */.highlight .na { color: #03a9f4 } /* Name.Attribute */.highlight .nc { color: #03a9f4} /* Name.Class */.highlight .nd { color: #757575 } /* Name.Decorator */.highlight .nf { color: #03a9f4 } /* Name.Function */.highlight .mf { color: #757575 } /* Literal.Number.Float */.highlight .mh { color: #757575 } /* Literal.Number.Hex */.highlight .mi { color: #757575 } /* Literal.Number.Integer */.highlight .mo { color: #757575 } /* Literal.Number.Oct */.highlight .sb { color: #757575 } /* Literal.String.Backtick */.highlight .sc { color: #757575 } /* Literal.String.Char */.highlight .sd { color: #757575 } /* Literal.String.Doc */.highlight .s2 { color: #757575 } /* Literal.String.Double */.highlight .se { color: #757575 } /* Literal.String.Escape */.highlight .sh { color: #757575 } /* Literal.String.Heredoc */.highlight .si { color:#757575 } /* Literal.String.Interpol */.highlight .sx { color: #757575 } /* Literal.String.Other */.highlight .sr { color: #757575 } /* Literal.String.Regex */.highlight .s1 { color: #757575 } /* Literal.String.Single */.highlight .ss { color: #757575 } /* Literal.String.Symbol */.highlight {tab-size: 4;}div.highlighter-rouge{padding:5px;background:#f5f5f5;border:1px solid #bdbdbd;border-radius:4px;}div.highlight pre.highlight{margin:0px;}code.highlighter-rouge{padding:0px 3px;background:#f5f5f5;border:1px solid #bdbdbd;border-radius:3px;}/* Make headers a little bit smaller */h1{font-size:2.8rem;}h2{font-size:2.5rem;}h3{font-size:2.1rem;}h4{font-size:1.8rem;}h5{font-size:1.3rem;}h6{font-size:1rem;}/* Plain text */p{text-align:justify;}/* Blockquotes */blockquote{border-left:3px solid #03a9f4;font-style:italic;font-weight:300;}/* Tables */table.striped>tbody>tr:nth-child(odd){background-color:#f5f5f5;}/* Cards */.card .card-image .card-title{color: #212121; font-weight: 600; padding-bottom: 0px; padding-left:12px; padding-right: 12px;}.card-content{color: #757575;}.card .card-content{padding-top: 5px;}.card .card-action a:not(.btn):not(.btn-large):not(.btn-large):not(.btn-floating){color: #424242;}.card .card-action a:not(.btn):not(.btn-large):not(.btn-large):not(.btn-floating):hover{color: #03a9f4;}.card.small{height: 225px;}.card-placeholder-image{color:#bdbdbd;}.card-image img{opacity: 0.3;}.card-image h2{opacity: 0.3;}.card .card-image{min-height:60%;}/* Breadcrumbs */nav{background-color: #FFFFFF;}a.breadcrumb{color: #757575;}.breadcrumb:last-child{color:#03a9f4;}.breadcrumb:before{color:#757575;font-size:15px;}nav.breadcrumbs{box-shadow:none;margin-top:4px;}ul.collapsible{list-style-type: none;padding:0px;}.collapsible-header{border-bottom:0px;}.collapsible-body{padding:5px;}/* Table of Contents */.second-level{padding:0px;}.table-of-contents .second-level a{padding-left:40px;font-size:13px;}.table-of-contents a{color:#757575;}.table-of-contents a:hover{border-left:1px solid #03a9f4;color:#03a9f4;}.table-of-contents a.active{border-left:2px solid #03a9f4;color:#757575;}.toc-wrapper li{padding:1px;}/* Navigation Arrows */.prev-nav{top: 50%;left: 3%;position:fixed;}.next-nav{top: 50%;right: 3%;position:fixed;}</style>

  <body>
	<!-- Navigation Header -->
	<nav class="white lighten-1" role="navigation">
	<div class="nav-wrapper container">
		<a id="logo-container" class="brand-logo logo show-on-medium-and-up hide-on-small-only" href="/"><img src="/logo.png"></a>
		<a id="logo-container" class="brand-logo logo show-on-small hide-on-med-and-up" href="/"><img src="/logo-small.png"></a>
	  
	  
	
	  <ul class="right hide-on-med-and-down">
		
			
			<li><a href="/tutorials.html">Tutorials</a></li>
		
			
			<li><a href="/modules.html">Modules</a></li>
		
			
			<li><a href="/projects.html">Projects</a></li>
		
			
			<li><a href="/contribute.html">Contribute</a></li>
		
		
			<li>
				<a title="modularcode.site on GitHub" href="https://github.com/Sandared/modularcode.site"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>github</title>
						<path d="M10 0C4.477 0 0 4.477 0 10c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.342-3.369-1.342-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.268 2.75 1.026A9.578 9.578 0 0 1 10 4.836c.85.004 1.705.114 2.504.337 1.909-1.294 2.747-1.026 2.747-1.026.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.579.688.481C17.137 18.163 20 14.418 20 10c0-5.523-4.478-10-10-10" fill-rule="evenodd">
						</path>
					</svg>					
				</a>
			</li>
		
		
		
			<li>
				<a title="modularco_de on Twitter" href="https://twitter.com/modularco_de"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>twitter</title>
						<path d="M15.115 7.788c.005.11.009.223.009.335 0 3.43-2.611 7.384-7.386 7.384-1.467 0-2.831-.43-3.98-1.166a5.244 5.244 0 0 0 3.843-1.075 2.596 2.596 0 0 1-2.424-1.801 2.645 2.645 0 0 0 1.171-.045 2.597 2.597 0 0 1-2.082-2.544v-.033c.351.194.752.311 1.177.324a2.59 2.59 0 0 1-1.154-2.16c0-.475.127-.92.35-1.305A7.37 7.37 0 0 0 9.99 8.414a2.596 2.596 0 0 1 4.423-2.367 5.174 5.174 0 0 0 1.648-.63 2.602 2.602 0 0 1-1.142 1.436 5.17 5.17 0 0 0 1.491-.41 5.233 5.233 0 0 1-1.295 1.345M10 0C4.486 0 0 4.486 0 10s4.486 10 10 10 10-4.486 10-10S15.514 0 10 0" fill-rule="evenodd">
						</path>
					</svg>			
				</a>
			</li>
		
	  </ul>

	  <ul id="nav-mobile" class="side-nav">
		<li><a href="http://localhost:4000">Home</a></li>
		<li class="divider"></li>
		
			
			<li><a href="/tutorials.html">Tutorials</a></li>
			<li class="divider"></li>
		
			
			<li><a href="/modules.html">Modules</a></li>
			<li class="divider"></li>
		
			
			<li><a href="/projects.html">Projects</a></li>
			<li class="divider"></li>
		
			
			<li><a href="/contribute.html">Contribute</a></li>
			<li class="divider"></li>
		
		
			<li>
				<a title="modularcode.site on GitHub" href="https://github.com/Sandared/modularcode.site"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>github</title>
						<path d="M10 0C4.477 0 0 4.477 0 10c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.342-3.369-1.342-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.268 2.75 1.026A9.578 9.578 0 0 1 10 4.836c.85.004 1.705.114 2.504.337 1.909-1.294 2.747-1.026 2.747-1.026.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.579.688.481C17.137 18.163 20 14.418 20 10c0-5.523-4.478-10-10-10" fill-rule="evenodd">
						</path>
					</svg>					
				</a>
			</li>
			<li class="divider"></li>
		
		
		
			<li>
				<a title="modularco_de on Twitter" href="https://twitter.com/modularco_de"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>twitter</title>
						<path d="M15.115 7.788c.005.11.009.223.009.335 0 3.43-2.611 7.384-7.386 7.384-1.467 0-2.831-.43-3.98-1.166a5.244 5.244 0 0 0 3.843-1.075 2.596 2.596 0 0 1-2.424-1.801 2.645 2.645 0 0 0 1.171-.045 2.597 2.597 0 0 1-2.082-2.544v-.033c.351.194.752.311 1.177.324a2.59 2.59 0 0 1-1.154-2.16c0-.475.127-.92.35-1.305A7.37 7.37 0 0 0 9.99 8.414a2.596 2.596 0 0 1 4.423-2.367 5.174 5.174 0 0 0 1.648-.63 2.602 2.602 0 0 1-1.142 1.436 5.17 5.17 0 0 0 1.491-.41 5.233 5.233 0 0 1-1.295 1.345M10 0C4.486 0 0 4.486 0 10s4.486 10 10 10 10-4.486 10-10S15.514 0 10 0" fill-rule="evenodd">
						</path>
					</svg>			
				</a>
			</li>
			<li class="divider"></li>
		
	  </ul>        

	  <a data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
	</div>
</nav>
	
	
	
  <main>	
  <div class="container">
		<div class="row">	
		
			<div id="text-content" class="section col s12 l10">
				


<nav class="breadcrumbs">
	<div class="nav-wrapper">
	
	
		
	
		
			
			
			
			
			
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
			
				
					
					<a href="http://localhost:4000/tutorials.html" class="breadcrumb">Tutorials</a>
				
			
		
	
		
			
			
			
			
			
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
					
				
				<a href="http://localhost:4000/tutorials/maven_only_tutorial.html" class="breadcrumb">Maven ONLY Tutorial</a>
				
			
		
	
		
			
			
			
			
			
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
					
				
				<a href="http://localhost:4000/tutorials/maven_only_tutorial/run.html" class="breadcrumb">OSGi Runtime</a>
				
			
		
	
	</div>
</nav>

				<h1 id="osgi-runtime">OSGi Runtime</h1>

<h2 id="what-you-will-learn-in-this-section">What You Will Learn in This Section</h2>

<p>In this section we start by defining a <em>runtime</em> environment. An OSGi runtime
environment consists of a classpath, a framework, and a number of configuration
properties that properly setup the framework. In contrast with the application
server model, the runtime is unique for the application. In this section
we show how to create an executable JAR that contains all the dependencies.</p>

<p>Running a framework requires <em>assembling</em> the application. Assembly consists of
selecting an appropriate set of bundles and defining the framework’s context.</p>

<p>This requires to select the <em>initial requirements</em> of a runtime and then let bnd 
resolve this into a set of <em>run bundles</em>. Once we have got this set of run bundles
we can export it into an executable JAR or other format.</p>

<p>Make sure you are in the top directory:</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd ~/workspaces/osgi.enroute.examples.eval
</code></pre></div></div>

<h2 id="the-pom">The POM</h2>

<p>In the <code class="highlighter-rouge">osgi.enroute.examples.eval</code> directory we create the <code class="highlighter-rouge">pom.xml</code> file in a new
<code class="highlighter-rouge">bndrun</code> directory.</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>osgi.enroute.examples.eval $ mkdir bndrun
osgi.enroute.examples.eval $ cd bndrun
bndrun $ vi pom.xml
// add the following file
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

	&lt;parent&gt;
		&lt;groupId&gt;org.osgi&lt;/groupId&gt;
		&lt;artifactId&gt;osgi.enroute.examples.eval&lt;/artifactId&gt;
		&lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
	&lt;/parent&gt;

	&lt;artifactId&gt;osgi.enroute.examples.eval.bndrun&lt;/artifactId&gt;

	&lt;packaging&gt;jar&lt;/packaging&gt;
</code></pre></div></div>

<p>We will define the OSGi runtime environment in a <code class="highlighter-rouge">bndrun</code> file. This file contains
the myriad of details that is needed to define an OSGi runtime. Details like the
class path, the set of bundles, system properties, framework configuration, etc. We
will use the <code class="highlighter-rouge">bnd-export-maven-plugin</code>. This plugin will take a bndrun file as input
and then generate an executable JAR. This is a JAR that contains all its dependencies.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
</code></pre></div></div>

<p class="note">We’re using the 3.4.0-SNAPSHOT revision because this tutorial needed a newer feature that missed 3.3</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>				&lt;groupId&gt;biz.aQute.bnd&lt;/groupId&gt;
				&lt;artifactId&gt;bnd-export-maven-plugin&lt;/artifactId&gt;
				&lt;version&gt;3.4.0-SNAPSHOT&lt;/version&gt;
</code></pre></div></div>

<p>We need to configure the plugin.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>				&lt;configuration&gt;
					&lt;resolve&gt;true&lt;/resolve&gt;
					&lt;bndruns&gt;
</code></pre></div></div>

<p>Here we specify one or more bndrun files. We’ll discuss the format of this file later.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>						&lt;bndrun&gt;osgi.enroute.examples.eval.bndrun&lt;/bndrun&gt;
					&lt;/bndruns&gt;
					&lt;targetDir&gt;.&lt;/targetDir&gt;
				&lt;/configuration&gt;
				&lt;executions&gt;
					&lt;execution&gt;
						&lt;goals&gt;
							&lt;goal&gt;export&lt;/goal&gt;
						&lt;/goals&gt;
					&lt;/execution&gt;
				&lt;/executions&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;
</code></pre></div></div>

<p>We need to add our provider as a runtime dependency:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.osgi&lt;/groupId&gt;
			&lt;artifactId&gt;osgi.enroute.examples.eval.simple.provider&lt;/artifactId&gt;
			&lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
		&lt;/dependency&gt;
</code></pre></div></div>

<p>We also need a <em>distro</em>. So far we’ve been compiling against API only with the OSGi enRoute base
API. However, we now need to add implementations. Implementations can come from different sources. For
example IBM websphere, Karaf, Knopflerfish, Apache Felix, etc. However, the OSGi enRoute project
has created a distro that consists of many different open source projects to demonstrate
the interoperability of OSGi.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		&lt;dependency&gt;
			&lt;groupId&gt;org.osgi&lt;/groupId&gt;
			&lt;artifactId&gt;osgi.enroute.pom.distro&lt;/artifactId&gt;
			&lt;version&gt;2.0.0&lt;/version&gt;
		&lt;/dependency&gt;

	&lt;/dependencies&gt;
&lt;/project&gt;
</code></pre></div></div>

<p>We must also add bndrun as module in the parent pom.xml, e.g. after the existing api and simple.provider modules.</p>

<h2 id="the-bndrun-file">The bndrun file</h2>

<p>The <code class="highlighter-rouge">osgi.enroute.examples.eval.bndrun</code> bndrun file contains a specification of an
OSGi runtime. An OSGi runtime needs quite a bit of information and we collect that
all in this file.</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bndrun $ vi osgi.enroute.examples.eval.bndrun
// add the following file
</code></pre></div></div>

<p>The <code class="highlighter-rouge">-standalone</code> instruction is there to indicate that this does not run in bndtools
but as a stand-alone definition.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-standalone: 
</code></pre></div></div>

<p>We need access to all the dependencies of this project. The bndrun file supports this
with the Bnd Pom Repository. We then need to define the list of snapshot URLs and 
release URLs.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-plugin.examples.eval = \
	aQute.bnd.repository.maven.pom.provider.BndPomRepository; \
		snapshotUrls=https://oss.sonatype.org/content/repositories/osgi/; \
		releaseUrls=https://repo1.maven.org/maven2/; \
		pom=${.}/pom.xml; \
		name=examples.eval; \
		location=${.}/target/cached.xml
</code></pre></div></div>

<p>In the <code class="highlighter-rouge">-runrequires</code> section we list OSGi requirements that we want our runtime
to have. In the initial case we only need the provider to run. The syntax for
the <code class="highlighter-rouge">-runrequires</code> is the syntax for an OSGi <em>requirement</em>, as used in the
OSGi Require-Capability header. Each clause consists of a <em>namespace</em> and a 
<em>filter</em>. The namespace defines a number of properties and the filter is an assertion
on these properties. In this case we use the identity namespace to require a specific
bundle, the provider bundle. The property name is <code class="highlighter-rouge">osgi.identity</code> following the
convention for namespaces and the Bundle Symbolic Name is <code class="highlighter-rouge">osgi.enroute.examples.eval.simple.provider</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-runrequires: 	\
	osgi.identity; \
		filter:='(osgi.identity=osgi.enroute.examples.eval.simple.provider)'
</code></pre></div></div>

<p>The <code class="highlighter-rouge">-runfw</code> specifies the framework we want to use.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-runfw: 		org.eclipse.osgi;version='[3.10.100.v20150529-1857,3.10.100.v20150529-1857]'
</code></pre></div></div>

<p>We can control the logging information during launching. Let’s keep this off for now:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-runtrace: 		false
</code></pre></div></div>

<p>In the example we use Equinox and equinox has a number of habits that need to be unlearned.
For example, it has a built-in shell but it is better to define the used shell 
using standard OSGi techniques. These settings will not be further explained here.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#
# OSGi enRoute setting. These settings
# fixup some of the issues around equinox 
# defaults.
#

-runee: 						JavaSE-1.8
-resolve.effective:				resolve, active

-runproperties.eqnx: 				\
	osgi.console.enable.builtin=false, \
	osgi.console=, \
	org.osgi.service.http.port=8080

-runpath.eqnx: 					osgi.enroute.equinox.log.adapter
-runrequires.eqnx: \
	osgi.identity;filter:='(osgi.identity=org.apache.felix.log)'

-runsystempackages.eqnx:		javax.script
-runsystemcapabilities.dflt: 	${native_capability}
</code></pre></div></div>

<h2 id="how-to-get-the--runbundles">How to get the -runbundles</h2>

<p>The definition so far cannot be run. We need to <em>resolve</em> the bndrun file. Resolving
will take the <code class="highlighter-rouge">-runrequires</code> and the repository and calculate a <em>closure</em> of bundles.
This closure then is the list of <code class="highlighter-rouge">-runbundles</code> that we need in our runtime.</p>

<p>We can resolve the requirements from Maven and get the list of bundles by running a <code class="highlighter-rouge">mvn install</code>
in this project. This will attempt to resolve the initial requirements and calculate the 
list of bundles. If the list differs from the <code class="highlighter-rouge">-runbundles</code> setting then the install will 
fail but it will give the list of calculated bundles:</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bndrun $ mvn install
...

-runbundles: \
	org.apache.felix.configadmin; version='[1.8.8,1.8.9)',\
	org.apache.felix.log; version='[1.0.1,1.0.2)',\
	org.apache.felix.scr; version='[2.0.2,2.0.3)',\
	org.eclipse.equinox.metatype; version='[1.4.100,1.4.101)',\
	org.osgi.service.metatype; version='[1.3.0,1.3.1)',\
	osgi.enroute.examples.eval.simple.provider; version='[1.0.0,1.0.1)'

[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
...
[INFO] ------------------------------------------------------------------------
</code></pre></div></div>

<p>You can now copy this list and paste it into the <code class="highlighter-rouge">osgi.enroute.examples.eval.bndrun</code>
file at the end. Make sure there is only one (1) <code class="highlighter-rouge">-runbundles</code> instruction in the bndrun file.</p>

<p>NOTE: You can add <failOnChanges>false</failOnChanges> inside bnd-export-maven-plugin configurations if you wish the update is done automatically.</p>

<p>If we now run maven again we succeed and a JAR file is created in the project directory.</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bndrun $ vi osgi.enroute.examples.eval.bndrun
// add/replace the -runbundles
bndrun $ mvn install
...
bndrun $ ls
osgi.enroute.examples.eval.bndrun	pom.xml					target
osgi.enroute.examples.eval.jar		src
</code></pre></div></div>

<h2 id="running">Running</h2>

<p>We can now run the application as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bndrun $ java -version
java version "1.8.0_25"
Java(TM) SE Runtime Environment (build 1.8.0_25-b17)
Java HotSpot(TM) 64-Bit Server VM (build 25.25-b02, mixed mode)
bndrun $ java -jar osgi.enroute.examples.eval.jar
</code></pre></div></div>

<p>The output is a little embarrassing …</p>

<p>Though rather disappointing, it does make sense since we’ve not created any bundle that
does something that is visual to us. So the lack of output is understandable.</p>

<p>You can use Control-C to quit the application.</p>

<h2 id="tracing">Tracing</h2>

<p>Since we do not see any output it would be nice to know if the launching was ok.
We can set the <code class="highlighter-rouge">-runtrace</code> instruction to <code class="highlighter-rouge">true</code> in the <code class="highlighter-rouge">osgi.enroute.examples.eval.bndrun</code> 
file to see the launching progress:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-runtrace: true
</code></pre></div></div>

<p>If we build and run the application, we see the following:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bndrun $ vi osgi.enroute.examples.eval.bndrun
// set -runtrace: true
bndrun $ mvn install
...
bndrun $ java -jar osgi.enroute.examples.eval.jar
# properties {launch.name=bndrun, osgi.console=, launch.noreferences=false, ...
...	
Id    State Modified      Location
0     ACTIV &lt;&gt;            System Bundle
1     ACTIV &lt;&gt;            jar/org.apache.felix.configadmin-1.8.8.jar
2     ACTIV &lt;&gt;            jar/org.apache.felix.log-1.0.1.jar
3     ACTIV &lt;&gt;            jar/org.apache.felix.scr-2.0.2.jar
4     ACTIV &lt;&gt;            jar/org.eclipse.equinox.metatype-1.4.100.v20150408-1437.jar
5     ACTIV &lt;&gt;            jar/org.osgi.service.metatype-1.3.0.jar
6     ACTIV &lt;&gt;            jar/osgi.enroute.examples.eval.provider-1.0.0-SNAPSHOT.jar
# framework=org.eclipse.osgi.launch.Equinox@7c0e2abd
# registered launcher with arguments for syncing
# will wait for a registered Runnable
</code></pre></div></div>

<p>The output is quite extensive. If you have problems during the launch it is a great help 
and including this information with a bug report is highly appreciated.</p>

<h2 id="the-gogo-shell">The Gogo Shell</h2>

<p>What we’re missing is a shell to see the inner bowels of our runtime. The most
popular shell in OSGi is the Gogo shell. We can add this shell by adding it as 
an initial run requirement in the <code class="highlighter-rouge">osgi.enroute.examples.eval.bndrun</code> file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-runrequires: \
	osgi.identity;filter:='(osgi.identity=osgi.enroute.examples.eval.simple.provider)',\
	osgi.identity;filter:='(osgi.identity=osgi.enroute.gogo.shell.provider)'
</code></pre></div></div>

<p>You probably also want to set <code class="highlighter-rouge">-runtrace</code> to <code class="highlighter-rouge">false</code> to minimize the output. We
will now get a shell; as long as the shell works we can assume the launch was
ok.</p>

<p>We now need to resolve the bndrun file. We run <code class="highlighter-rouge">mvn install</code> which will fail
because the new list of bundles does not match the current list of bundles. We
then copy the <code class="highlighter-rouge">-runbundles</code> into the  <code class="highlighter-rouge">osgi.enroute.examples.eval.bndrun</code> file by
replacing the existing list. (Make sure you do not get more than 1 <code class="highlighter-rouge">-runbundles</code>
instruction in the file.)</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bndrun $ vi osgi.enroute.examples.eval.bndrun
// add the -runrequires for Gogo
bndrun $ mvn install
....
-runbundles: \
	org.apache.felix.configadmin; version='[1.8.8,1.8.9)',\
	org.apache.felix.gogo.runtime; version='[0.16.2,0.16.3)',\
	org.apache.felix.log; version='[1.0.1,1.0.2)',\
	org.apache.felix.scr; version='[2.0.2,2.0.3)',\
	org.eclipse.equinox.metatype; version='[1.4.100,1.4.101)',\
	org.osgi.service.metatype; version='[1.3.0,1.3.1)',\
	osgi.enroute.examples.eval.provider; version='[1.0.0,1.0.1)',\
	osgi.enroute.gogo.shell.provider; version='[2.0.0,2.0.1)'
....
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
bndrun $ vi osgi.enroute.examples.eval.bndrun
// copy the -runbundles from the output of mvn into the file
// replacing the existing -runbundles 
bndrun $ mvn install
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
bndrun $ java -jar osgi.enroute.examples.eval.jar 
             ____             _       
   ___ _ __ |  _ \ ___  _   _| |_ ___ 
  / _ \ '_ \| |_) / _ \| | | | __/ _ \
 |  __/ | | |  _ &lt; (_) | |_| | |_  __/
  \___|_| |_|_| \_\___/ \__,_|\__\___|
              http://enroute.osgi.org/
              
G! 
</code></pre></div></div>

<p>Gogo has many commands. You can find an introduction at the <a href="http://enroute.osgi.org/appnotes/gogo.html">Gogo App Note</a>.</p>

<p>For example:</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>G! bundles
0|Active     |    0|org.eclipse.osgi (3.10.100.v20150529-1857)
1|Active     |    1|org.apache.felix.configadmin (1.8.8)
2|Active     |    1|org.apache.felix.gogo.runtime (0.16.2)
3|Active     |    1|org.apache.felix.log (1.0.1)
4|Active     |    1|org.apache.felix.scr (2.0.2)
5|Active     |    1|org.eclipse.equinox.metatype (1.4.100.v20150408-1437)
6|Active     |    1|org.osgi.service.metatype (1.3.0.201505202024)
7|Active     |    1|osgi.enroute.examples.eval.provider (1.0.0.201610030911)
8|Active     |    1|osgi.enroute.gogo.shell.provider (2.0.0.201608121439-SNAPSHOT)
G! 
</code></pre></div></div>

<h1 id="user-friendly-commands">User Friendly Commands</h1>

<p>What we’re running is the base core primitive simple Gogo shell. This means it can run 
the commands that are on the Bundle Context (that is <code class="highlighter-rouge">bundles</code> command is mapped
to <code class="highlighter-rouge">BundleContext.getBundles()</code>) but there are now user friendly commands. A number
of such commands are implemented in the <code class="highlighter-rouge">org.apache.felix.gogo.command</code> bundle. So we
could add this bundle to the <code class="highlighter-rouge">-runrequires</code> instruction:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-runrequires: \
	osgi.identity;filter:='(osgi.identity=osgi.enroute.examples.eval.simple.provider)',\
	osgi.identity;filter:='(osgi.identity=osgi.enroute.gogo.shell.provider)',\
	osgi.identity;filter:='(osgi.identity=org.apache.felix.gogo.command)'
</code></pre></div></div>

<p>So now you can resolve again and then we can run <code class="highlighter-rouge">help</code> in the Gogo shell:</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bndrun $ vi osgi.enroute.examples.eval.bndrun
// replace the -runrequires
bndrun $ mvn install
...

-runbundles: ...
...
bndrun $ vi osgi.enroute.examples.eval.bndrun
// replace -runbundles
bndrun $ java -jar osgi.enroute.examples.eval.jar 
             ____             _       
   ___ _ __ |  _ \ ___  _   _| |_ ___ 
  / _ \ '_ \| |_) / _ \| | | | __/ _ \
 |  __/ | | |  _ &lt; (_) | |_| | |_  __/
  \___|_| |_|_| \_\___/ \__,_|\__\___|
              http://enroute.osgi.org/

              
G! help
felix:bundlelevel
felix:cd
felix:frameworklevel
felix:headers
...
scr:config
scr:disable
scr:enable
scr:info
scr:list
G! 
</code></pre></div></div>

<h2 id="what-did-we-learn">What did We Learn?</h2>

<p>In this section we’ve created a bndrun file to create an OSGi runtime. We then
learned how to add requirements to the file and resolve it so we get the <code class="highlighter-rouge">-runbundles</code>.
We then learned how to add these <code class="highlighter-rouge">-runbundles</code> to the bndrun file so they can
be exported into an executable jar.</p>

<p>We then executed this JAR and added a Gogo shell.</p>


		    </div>
			<div class="col hide-on-med-and-down l2">
				<div id="toc-wrapper" class="toc-wrapper pin-top">
				  <ul id="toc" class="section table-of-contents">
					
				  </ul>
				</div>
			</div>
			
			
				
				<div class="col s6 left-align hide-on-large-only show-on-med-and-down"><a href="provider-junit.html"><i class="large material-icons">keyboard_arrow_left</i></a></div>
			
			
				<div class="col s6  right-align hide-on-large-only show-on-med-and-down"><a href="command.html"><i class="large material-icons">keyboard_arrow_right</i></a></div>
			
			
			
				<div class="prev-nav hide-on-med-and-down"><a href="provider-junit.html"><i class="small material-icons">keyboard_arrow_left</i></a></div>
			
			
				<div class="next-nav hide-on-med-and-down"><a href="command.html"><i class="small material-icons">keyboard_arrow_right</i></a></div>
			
		
			
    </div> 
	
  </div>
  </main>
	<footer class="page-footer">
    <!--<div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5>Lorem Ipsum</h5>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        </div>
      </div>
    </div>-->
    <div class="footer-copyright">
        <div class="container">
            <div>
				<span style="text-align: left; float: left; width: 30%;">
				Made with <a target="_blank" href="http://materializecss.com">Materialize</a>
				</span>
				<span style="text-align: center; float: left; width: 40%;">
				Copyright © 2018 <a href="https://twitter.com/SanfteSchorle">Thomas Driessen</a>
				</span>
                <span style="text-align: right; float: left; width: 30%;">
				Powered by <a target="_blank" href="http://jekyllrb.com/">Jekyll</a>
                </span>
            </div>
        </div>
    </div>
</footer>      
	<!--  Scripts-->  

<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/materialize.min.js"></script>
<script src="/assets/js/init.js"></script>	
	<script src="/assets/js/content.js"></script>	
  </body>

</html>