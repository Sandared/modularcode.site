<!DOCTYPE html>
<html lang="en"><head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
    <title>Provider Bundle Project</title>
    <meta name="description" content="Provider Bundle Project" />
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen,projection" href="/assets/materialize.css" />
    <link rel="canonical" href="http://localhost:4000/tutorials/maven_only_tutorial/provider.html" />
    <link rel="alternate" type="application/rss+xml" title="modularcode" href="/feed.xml" />
    
</head>
<!-- Is it a content or a nested page -->
	
	
	
	<style>a {color: #757575;fill:#424242;font-weight:450;}a:hover {color: #03a9f4;fill:#03a9f4;}h1,h2,h3,h4,h5,h6{color: #424242;}body{color: #212121; display: flex; min-height: 100vh; flex-direction: column;}nav ul a{color: #424242;}nav .brand-logo{color: #424242}.justify-align{text-align:justify;}nav a{color: #424242;}main{flex: 1 0 auto;}.side-nav li>a{color: #424242;}.side-nav .collapsible-header, .side-nav.fixed .collapsible-header{padding-left:32px;}.side-nav .collapsible-body li a, .side-nav.fixed .collapsible-body li a{padding-left:47px;}h1,h2,h3,h4,h5,h6{-webkit-font-smoothing: antialiased;}.icon-block{padding: 0 15px;}.icon-block .material-icons{font-size: inherit;}.row{margin-bottom:0px;}.logo img{padding-top:3px;}.page-footer{background-color:#03a9f4; padding-top: 0px;}.nav-button{width:20px; height:20px; viewBox:0 0 20 20;}footer h5{color:#FFFFFF;}hr{background-color:#bdbdbd;}.divider{background-color:#bdbdbd;}img{max-width: 100%; height: auto;}.page-footer .footer-copyright{background-color:#03a9f4;}/* Code Highlighting */.highlight .c { color: #bdbdbd; font-style: italic } /* Comment */.highlight .k { color: #212121; font-weight: bold } /* Keyword */.highlight .cm { color: #bdbdbd; font-style: italic } /* Comment.Multiline */.highlight .c1 { color: #bdbdbd; font-style: italic } /* Comment.Single */.highlight .kc { color: #424242; font-weight: bold } /* Keyword.Constant */.highlight .kd { color: #212121; font-weight: bold } /* Keyword.Declaration */.highlight .kn { color: #424242; font-weight: bold } /* Keyword.Namespace */.highlight .kp { color: #424242; font-weight: bold } /* Keyword.Pseudo */.highlight .kr { color: #424242; font-weight: bold } /* Keyword.Reserved */.highlight .kt { color: #424242; font-weight: bold } /* Keyword.Type */.highlight .s { color: #757575 } /* Literal.String */.highlight .n { color: #03a9f4 } /* Name */.highlight .na { color: #03a9f4 } /* Name.Attribute */.highlight .nc { color: #03a9f4} /* Name.Class */.highlight .nd { color: #757575 } /* Name.Decorator */.highlight .nf { color: #03a9f4 } /* Name.Function */.highlight .mf { color: #757575 } /* Literal.Number.Float */.highlight .mh { color: #757575 } /* Literal.Number.Hex */.highlight .mi { color: #757575 } /* Literal.Number.Integer */.highlight .mo { color: #757575 } /* Literal.Number.Oct */.highlight .sb { color: #757575 } /* Literal.String.Backtick */.highlight .sc { color: #757575 } /* Literal.String.Char */.highlight .sd { color: #757575 } /* Literal.String.Doc */.highlight .s2 { color: #757575 } /* Literal.String.Double */.highlight .se { color: #757575 } /* Literal.String.Escape */.highlight .sh { color: #757575 } /* Literal.String.Heredoc */.highlight .si { color:#757575 } /* Literal.String.Interpol */.highlight .sx { color: #757575 } /* Literal.String.Other */.highlight .sr { color: #757575 } /* Literal.String.Regex */.highlight .s1 { color: #757575 } /* Literal.String.Single */.highlight .ss { color: #757575 } /* Literal.String.Symbol */.highlight {tab-size: 4;}div.highlighter-rouge{padding:5px;background:#f5f5f5;border:1px solid #bdbdbd;border-radius:4px;}div.highlight pre.highlight{margin:0px;}code.highlighter-rouge{padding:0px 3px;background:#f5f5f5;border:1px solid #bdbdbd;border-radius:3px;}/* Make headers a little bit smaller */h1{font-size:2.8rem;}h2{font-size:2.5rem;}h3{font-size:2.1rem;}h4{font-size:1.8rem;}h5{font-size:1.3rem;}h6{font-size:1rem;}/* Plain text */p{text-align:justify;}/* Blockquotes */blockquote{border-left:3px solid #03a9f4;font-style:italic;font-weight:300;}/* Tables */table.striped>tbody>tr:nth-child(odd){background-color:#f5f5f5;}/* Cards */.card .card-image .card-title{color: #212121; font-weight: 600; padding-bottom: 0px; padding-left:12px; padding-right: 12px;}.card-content{color: #757575;}.card .card-content{padding-top: 5px;}.card .card-action a:not(.btn):not(.btn-large):not(.btn-large):not(.btn-floating){color: #424242;}.card .card-action a:not(.btn):not(.btn-large):not(.btn-large):not(.btn-floating):hover{color: #03a9f4;}.card.small{height: 225px;}.card-placeholder-image{color:#bdbdbd;}.card-image img{opacity: 0.3;}.card-image h2{opacity: 0.3;}.card .card-image{min-height:60%;}/* Breadcrumbs */nav{background-color: #FFFFFF;}a.breadcrumb{color: #757575;}.breadcrumb:last-child{color:#03a9f4;}.breadcrumb:before{color:#757575;font-size:15px;}nav.breadcrumbs{box-shadow:none;margin-top:4px;}ul.collapsible{list-style-type: none;padding:0px;}.collapsible-header{border-bottom:0px;}.collapsible-body{padding:5px;}/* Table of Contents */.second-level{padding:0px;}.table-of-contents .second-level a{padding-left:40px;font-size:13px;}.table-of-contents a{color:#757575;}.table-of-contents a:hover{border-left:1px solid #03a9f4;color:#03a9f4;}.table-of-contents a.active{border-left:2px solid #03a9f4;color:#757575;}.toc-wrapper li{padding:1px;}/* Navigation Arrows */.prev-nav{top: 50%;left: 3%;position:fixed;}.next-nav{top: 50%;right: 3%;position:fixed;}</style>

  <body>
	<!-- Navigation Header -->
	<nav class="white lighten-1" role="navigation">
	<div class="nav-wrapper container">
		<a id="logo-container" class="brand-logo logo show-on-medium-and-up hide-on-small-only" href="/"><img src="/logo.png"></a>
		<a id="logo-container" class="brand-logo logo show-on-small hide-on-med-and-up" href="/"><img src="/logo-small.png"></a>
	  
	  
	
	  <ul class="right hide-on-med-and-down">
		
			
			<li><a href="/tutorials.html">Tutorials</a></li>
		
			
			<li><a href="/modules.html">Modules</a></li>
		
			
			<li><a href="/projects.html">Projects</a></li>
		
			
			<li><a href="/contribute.html">Contribute</a></li>
		
		
			<li>
				<a title="modularcode.site on GitHub" href="https://github.com/Sandared/modularcode.site"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>github</title>
						<path d="M10 0C4.477 0 0 4.477 0 10c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.342-3.369-1.342-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.268 2.75 1.026A9.578 9.578 0 0 1 10 4.836c.85.004 1.705.114 2.504.337 1.909-1.294 2.747-1.026 2.747-1.026.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.579.688.481C17.137 18.163 20 14.418 20 10c0-5.523-4.478-10-10-10" fill-rule="evenodd">
						</path>
					</svg>					
				</a>
			</li>
		
		
		
			<li>
				<a title="modularco_de on Twitter" href="https://twitter.com/modularco_de"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>twitter</title>
						<path d="M15.115 7.788c.005.11.009.223.009.335 0 3.43-2.611 7.384-7.386 7.384-1.467 0-2.831-.43-3.98-1.166a5.244 5.244 0 0 0 3.843-1.075 2.596 2.596 0 0 1-2.424-1.801 2.645 2.645 0 0 0 1.171-.045 2.597 2.597 0 0 1-2.082-2.544v-.033c.351.194.752.311 1.177.324a2.59 2.59 0 0 1-1.154-2.16c0-.475.127-.92.35-1.305A7.37 7.37 0 0 0 9.99 8.414a2.596 2.596 0 0 1 4.423-2.367 5.174 5.174 0 0 0 1.648-.63 2.602 2.602 0 0 1-1.142 1.436 5.17 5.17 0 0 0 1.491-.41 5.233 5.233 0 0 1-1.295 1.345M10 0C4.486 0 0 4.486 0 10s4.486 10 10 10 10-4.486 10-10S15.514 0 10 0" fill-rule="evenodd">
						</path>
					</svg>			
				</a>
			</li>
		
	  </ul>

	  <ul id="nav-mobile" class="side-nav">
		<li><a href="http://localhost:4000">Home</a></li>
		<li class="divider"></li>
		
			
			<li><a href="/tutorials.html">Tutorials</a></li>
			<li class="divider"></li>
		
			
			<li><a href="/modules.html">Modules</a></li>
			<li class="divider"></li>
		
			
			<li><a href="/projects.html">Projects</a></li>
			<li class="divider"></li>
		
			
			<li><a href="/contribute.html">Contribute</a></li>
			<li class="divider"></li>
		
		
			<li>
				<a title="modularcode.site on GitHub" href="https://github.com/Sandared/modularcode.site"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>github</title>
						<path d="M10 0C4.477 0 0 4.477 0 10c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.342-3.369-1.342-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.268 2.75 1.026A9.578 9.578 0 0 1 10 4.836c.85.004 1.705.114 2.504.337 1.909-1.294 2.747-1.026 2.747-1.026.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.579.688.481C17.137 18.163 20 14.418 20 10c0-5.523-4.478-10-10-10" fill-rule="evenodd">
						</path>
					</svg>					
				</a>
			</li>
			<li class="divider"></li>
		
		
		
			<li>
				<a title="modularco_de on Twitter" href="https://twitter.com/modularco_de"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>twitter</title>
						<path d="M15.115 7.788c.005.11.009.223.009.335 0 3.43-2.611 7.384-7.386 7.384-1.467 0-2.831-.43-3.98-1.166a5.244 5.244 0 0 0 3.843-1.075 2.596 2.596 0 0 1-2.424-1.801 2.645 2.645 0 0 0 1.171-.045 2.597 2.597 0 0 1-2.082-2.544v-.033c.351.194.752.311 1.177.324a2.59 2.59 0 0 1-1.154-2.16c0-.475.127-.92.35-1.305A7.37 7.37 0 0 0 9.99 8.414a2.596 2.596 0 0 1 4.423-2.367 5.174 5.174 0 0 0 1.648-.63 2.602 2.602 0 0 1-1.142 1.436 5.17 5.17 0 0 0 1.491-.41 5.233 5.233 0 0 1-1.295 1.345M10 0C4.486 0 0 4.486 0 10s4.486 10 10 10 10-4.486 10-10S15.514 0 10 0" fill-rule="evenodd">
						</path>
					</svg>			
				</a>
			</li>
			<li class="divider"></li>
		
	  </ul>        

	  <a data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
	</div>
</nav>
	
	
	
  <main>	
  <div class="container">
		<div class="row">	
		
			<div id="text-content" class="section col s12 l10">
				


<nav class="breadcrumbs">
	<div class="nav-wrapper">
	
	
		
	
		
			
			
			
			
			
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
			
				
					
					<a href="http://localhost:4000/tutorials.html" class="breadcrumb">Tutorials</a>
				
			
		
	
		
			
			
			
			
			
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
					
				
				<a href="http://localhost:4000/tutorials/maven_only_tutorial.html" class="breadcrumb">Maven ONLY Tutorial</a>
				
			
		
	
		
			
			
			
			
			
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
					
				
				<a href="http://localhost:4000/tutorials/maven_only_tutorial/provider.html" class="breadcrumb">Provider Bundle Project</a>
				
			
		
	
	</div>
</nav>

				<h1 id="provider-bundle-project">Provider Bundle Project</h1>

<h2 id="what-you-will-learn-in-this-section">What You will Learn in this Section</h2>

<p>In this section we create another project that provides an implementation for our 
Eval API, a so called <em>provider</em>. In this case we call this the <code class="highlighter-rouge">simple.provider</code>.
We will also export the api package from the
provider bundle and explain why this will be simplifying your life.</p>

<p><img src="img/simple-diagram.png" alt="API Diagram" /></p>

<p>Make sure you are in the top directory:</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd ~/workspaces/osgi.enroute.examples.eval
</code></pre></div></div>

<h2 id="about-services">About Services</h2>

<p>A <em>service</em> is an object that is registered by a <em>bundle</em>. It is registered under
an interface and a set of properties. Services are dynamic which means that we
have to write code that uses services defensively. Since this  a lot of
work we use <a href="/services/org.osgi.service.component.html">Declarative Services</a> to simplify this considerably with annotations.</p>

<h2 id="create-a-provider-project">Create a Provider Project</h2>

<p>In the previous section we created an API for an expression evaluator. We now need a 
so called <em>provider</em> for this service. A provider is responsible for the contract 
defined in the API so that <em>consumers</em> can use the service. In the case of the 
Eval service the consumer will call the <code class="highlighter-rouge">eval(String)</code> method and the provider must 
implement this method.</p>

<p>In the <code class="highlighter-rouge">osgi.enroute.examples.eval</code> directory we create a directory called <code class="highlighter-rouge">simple.provider</code>.
In this directory we create the POM.</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>osgi.enroute.examples.eval $ mkdir simple.provider
osgi.enroute.examples.eval $ cd simple.provider
simple.provider $
</code></pre></div></div>

<h2 id="pom">POM</h2>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>simple.provider $ vi pom.xml
// fill in from next section
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;project 
	xmlns="http://maven.apache.org/POM/4.0.0" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"
&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
</code></pre></div></div>

<p>The parent and packaging is the same as for the API project:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;parent&gt;
  	&lt;groupId&gt;org.osgi&lt;/groupId&gt;
  	&lt;artifactId&gt;osgi.enroute.examples.eval&lt;/artifactId&gt;
  	&lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
  &lt;/parent&gt;
  
  &lt;packaging&gt;jar&lt;/packaging&gt;
</code></pre></div></div>

<p>In the previous section we also learned that the last segment in the 
project name defines its <em>type</em>; this is supported by OSGi enRoute templates. A provider 
project must therefore have a name that ends in <code class="highlighter-rouge">.provider</code>. We also like to start 
the project name with the workspace, the service API name and an indication of what 
kind of implementation this is. Well, this is going to be an awful simple implementation, 
so the name should be: <code class="highlighter-rouge">osgi.enroute.examples.eval.simple.provider</code>. So in the POM we should have:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;artifactId&gt;osgi.enroute.examples.eval.simple.provider&lt;/artifactId&gt;
  &lt;description&gt;Eval Provider&lt;/description&gt;
</code></pre></div></div>

<p>We inherit the OSGi enRoute base API (a collection of standardized and specialized service contracts to 
make it easy for web apps) but in this case we need the API project as dependency</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;dependencies&gt;
  	&lt;dependency&gt;
  		&lt;groupId&gt;org.osgi&lt;/groupId&gt;
  		&lt;artifactId&gt;osgi.enroute.examples.eval.api&lt;/artifactId&gt;
  		&lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
  	&lt;/dependency&gt;
  &lt;/dependencies&gt;
  
&lt;/project&gt;
</code></pre></div></div>

<h2 id="implementation-source">Implementation Source</h2>

<p>We now need to add an implementation class. In this case we use regular expressions as the parser to 
implement a very simplistic evaluation parser in the file <code class="highlighter-rouge">src/main/java/osgi/enroute/examples/eval/provider/EvalImpl.java</code>:</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>simple.provider $ mkdir -p src/main/java/osgi/enroute/examples/eval/provider
simple.provider $ vi src/main/java/osgi/enroute/examples/eval/provider/EvalImpl.java
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">osgi</span><span class="o">.</span><span class="na">enroute</span><span class="o">.</span><span class="na">examples</span><span class="o">.</span><span class="na">eval</span><span class="o">.</span><span class="na">provider</span><span class="o">;</span>
	
<span class="kn">import</span> <span class="nn">java.util.regex.Matcher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.regex.Pattern</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.osgi.service.component.annotations.Component</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.service.component.annotations.Reference</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.service.log.LogService</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">osgi.enroute.examples.eval.api.Eval</span><span class="o">;</span>

<span class="nd">@Component</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"osgi.enroute.examples.eval.provider"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EvalImpl</span> <span class="kd">implements</span> <span class="n">Eval</span> <span class="o">{</span>
	<span class="n">Pattern</span> <span class="n">EXPR</span> <span class="o">=</span> <span class="n">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span> <span class="s">"\\s*(?&lt;left&gt;\\d+)\\s*(?&lt;op&gt;\\+|-)\\s*(?&lt;right&gt;\\d+)\\s*"</span><span class="o">);</span>
	
	<span class="nd">@Reference</span>
	<span class="n">LogService</span> <span class="n">log</span><span class="o">;</span>
	
	
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">double</span> <span class="nf">eval</span><span class="o">(</span><span class="n">String</span> <span class="n">expression</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
		<span class="n">Matcher</span> <span class="n">m</span> <span class="o">=</span> <span class="n">EXPR</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">expression</span><span class="o">);</span>
		<span class="k">if</span> <span class="o">(</span> <span class="o">!</span><span class="n">m</span><span class="o">.</span><span class="na">matches</span><span class="o">())</span> <span class="o">{</span>
			<span class="n">log</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">LogService</span><span class="o">.</span><span class="na">LOG_WARNING</span><span class="o">,</span> <span class="s">"Invalid expression "</span> <span class="o">+</span> <span class="n">expression</span><span class="o">);</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Invalid expression "</span> <span class="o">+</span> <span class="n">expression</span><span class="o">);</span>
		<span class="o">}</span>
		
		<span class="kt">double</span> <span class="n">left</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span> <span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="s">"left"</span><span class="o">));</span>
		<span class="kt">double</span> <span class="n">right</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span> <span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="s">"right"</span><span class="o">));</span>
		<span class="k">switch</span><span class="o">(</span> <span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="s">"op"</span><span class="o">))</span> <span class="o">{</span>
		<span class="k">case</span> <span class="s">"+"</span><span class="o">:</span> <span class="k">return</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="o">;</span>
		<span class="k">case</span> <span class="s">"-"</span><span class="o">:</span> <span class="k">return</span> <span class="n">left</span> <span class="o">-</span> <span class="n">right</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">Double</span><span class="o">.</span><span class="na">NaN</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Ok, ok, simple might still give it too much credit but we’re not here to learn parsing. 
At least it has (some) error handling! Notice that we can only handle trivial additions and 
subtractions of constants.</p>

<p>This class is setup as a Declarative Service (DS) µservice component because the <code class="highlighter-rouge">@Component</code> 
annotation was added. If your component class implements one or more interfaces, then these 
will be automatically registered as OSGi services. So in this case, we want to implement 
an <code class="highlighter-rouge">Eval</code> interface so that we’re registered as an Eval service.</p>

<p>We can use the <code class="highlighter-rouge">Eval</code> interface because we added the <code class="highlighter-rouge">org.osgi:osgi.enroute.examples.eval.api:1.0.0-SNAPSHOT</code> project 
to our dependencies.</p>

<h2 id="the-bnd-file">The bnd File</h2>

<p>To make a proper bundle we need to have a <code class="highlighter-rouge">bnd.bnd</code> file in the same directory as our POM. This file looks
like:</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>simple.provider $ vi bnd.bnd
// fill in content from next section
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#
# OSGi enRoute Eval Example
#

Bundle-Description: 				\
	Provides a simple implementation for an eval parser

Export-Package: osgi.enroute.examples.eval.api
</code></pre></div></div>

<h2 id="exporting-api">Exporting API</h2>

<p>Observant readers would have noticed that the the <code class="highlighter-rouge">osgi.enroute.examples.eval.api</code> package is
exported but it is not part of this project. This is one of the magic, and extremely useful,
tricks of bnd. Any package listed in Export-Package or Private-Package headers will be copied
from the classpath even if not part of the project.</p>

<p>However, this raises the question why should the API be included in the bundle? Should the
API not be a separate bundle?</p>

<p>The reason we export the API from the provider bundle is that it makes life a lot easier
when we assemble the executable and it has no hidden cost. The primary reason it has no
hidden cost is due to <em>compatibility</em>. A provider has virtually no backward compatibility
with its API as was explained in the semantic versioning section. Any change in the
API will require an update of the provider code to ensure the provider implements any 
additional obligations of the contract.</p>

<p>Therefore, separating the API from the provider has no use since a given provider
will virtually always use the same API version. Carrying this version of the API
causes fewer bundles and less error prone metadata.</p>

<p>There are OSGi experts who do not completely agree though.</p>

<h2 id="build">Build</h2>

<p>In Maven-terms we’ve now defined a multi-module project, currently containing two modules : api and simple.provider.
The modules should be defined in an aggregator pom, and often this is done in the parent pom.
We should add a <modules> section in the pom.xml in the parent folder</modules></p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>simple.provider $ cd ..
osgi.enroute.examples.eval $ vi pom.xml
// fill in from next section, right before the &lt;properties&gt; section
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;modules&gt;
  	&lt;module&gt;api&lt;/module&gt;
  	&lt;module&gt;simple.provider&lt;/module&gt;
  &lt;/modules&gt;
</code></pre></div></div>

<p>We now have enough project information to build the bundle. As we’ve changed the parent pom, it’s best to do a clean build from there.
And then we can take a look at how our module (bundle) really looks like.
Make sure you’re in the top directory!</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>osgi.enroute.examples.eval $ mvn clean install
...
osgi.enroute.examples.eval $ cd simple.provider
simple.provider $ bnd print target/osgi.enroute.examples.eval.simple.provider-1.0.0-SNAPSHOT.jar
[MANIFEST osgi.enroute.examples.eval.provider-1.0.0-SNAPSHOT]
Bnd-LastModified                         1474989660493                           
Build-Jdk                                1.8.0_25                                
Built-By                                 aqute                                   
Bundle-Description                       Provides a simple implementation for an eval parser
Bundle-ManifestVersion                   2                                       
Bundle-Name                              osgi.enroute.examples.eval.simple.provider      
Bundle-SymbolicName                      osgi.enroute.examples.eval.simple.provider      
Bundle-Version                           1.0.0.201609271521                      
Created-By                               1.8.0_25 (Oracle Corporation)           
Export-Package                           osgi.enroute.examples.eval.api;version="1.0.0"
Import-Package                           osgi.enroute.examples.eval.api;version="[1.0,1.1)"
Manifest-Version                         1.0                                     
Private-Package                          osgi.enroute.examples.eval.provider      
Provide-Capability                       osgi.service;objectClass:List&lt;String&gt;="osgi.enroute.examples.eval.api.Eval"
Require-Capability                       osgi.ee;filter:="(&amp;(osgi.ee=JavaSE)(version=1.8))"
Require-Capability                       osgi.extender;filter:="(&amp;(osgi.extender=osgi.component)(version&gt;=1.3.0)(!(version&gt;=2.0.0)))",osgi.service;filter:="(objectClass=org.osgi.service.log.LogService)";effective:=active,osgi.ee;filter:="(&amp;(osgi.ee=JavaSE)(version=1.8))"
Service-Component                        OSGI-INF/osgi.enroute.examples.eval.provider.xml
Tool                                     Bnd-3.3.0.201609221906                  

[IMPEXP]
Import-Package
  org.osgi.service.log                    {version=[1.3,2)}
  osgi.enroute.examples.eval.api          {version=[1.0,1.1)}
Export-Package
  osgi.enroute.examples.eval.api          {version=1.0.0, imported-as=[1.0,1.1)}
</code></pre></div></div>

<p>From this we can see the following layout of our provider bundle.</p>

<ul>
  <li><em>Private packages</em> – Packages that are only available inside the bundle. Another 
bundle could have the same name for the package but different contents.</li>
  <li><em>Exported packages</em> – Packages that we provide to other bundles and which we are supposed to maintain over time.</li>
  <li><em>Imported packages</em> – Packages we expect someone else to export, hoping that they are as good as we will be in maintaining that package over time.</li>
</ul>

<p>In a diagram:</p>

<p><img src="img/provider-layout.png" alt="Exporting the  API" /></p>

<h2 id="how-does-it-work">How Does it Work?</h2>

<p>The concepts of consumers and providers can be confusing, mostly because it is often 
confused with implementers of an interface and the clients of an interface. However, 
providers of a service API can both implement and/or be a client of interfaces in 
the service package. A provider is responsible for providing the value of the contract, 
and a consumer receives the value of the contract. The reason we need to distinguish 
between these two roles is that they have far ranging consequences for how you package 
and version bundles.</p>

<p>Lets say you buy a house from me. In this scenario you are consumer of the contract 
and I am the provider of the contract. These roles are, surprisingly, not symmetrical. 
For example, if the seller adds an extra room after the contract was signed then the buyer 
will not object (ok, in general, you get my point). However, if the seller removes 
a room the buyer is going to be upset. A consumer can expect backward compatibility 
but a provider is closely bound to the contract. Virtually any change in the service 
contract will require a provider to be updated to provide the new functions.</p>

<p>So a consumer is relatively distant from the contract and it often plays the role 
of a consumer in many different service contracts. A provider usually provides only 
a single service contact while being a consumer in other service contracts.</p>

<p>Therefore the best practice in OSGi is for a provider to include its service API 
codes and export it. Separating the API from the provider makes no sense since 
there is a 1:1 relation between provider and API, unlike the consumer that will 
get backward compatibility from the API. Having the API in the bundle just makes 
life easier. That said, do not make the mistake to place them in the same <em>project</em> 
since that would require compiling against a JAR that would also contain the implementation. 
Compilation should always be done against API only JARs to prevent accidentally 
becoming dependent on implementation code.</p>

<h2 id="what-did-we-learn">What Did We Learn?</h2>

<p>In this section we created a simplistic provider bundle for the Eval service API.
We exported the Eval service API in this bundle but also import it.</p>


		    </div>
			<div class="col hide-on-med-and-down l2">
				<div id="toc-wrapper" class="toc-wrapper pin-top">
				  <ul id="toc" class="section table-of-contents">
					
				  </ul>
				</div>
			</div>
			
			
				
				<div class="col s6 left-align hide-on-large-only show-on-med-and-down"><a href="api.html"><i class="large material-icons">keyboard_arrow_left</i></a></div>
			
			
				<div class="col s6  right-align hide-on-large-only show-on-med-and-down"><a href="provider-junit.html"><i class="large material-icons">keyboard_arrow_right</i></a></div>
			
			
			
				<div class="prev-nav hide-on-med-and-down"><a href="api.html"><i class="small material-icons">keyboard_arrow_left</i></a></div>
			
			
				<div class="next-nav hide-on-med-and-down"><a href="provider-junit.html"><i class="small material-icons">keyboard_arrow_right</i></a></div>
			
		
			
    </div> 
	
  </div>
  </main>
	<footer class="page-footer">
    <!--<div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5>Lorem Ipsum</h5>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        </div>
      </div>
    </div>-->
    <div class="footer-copyright">
        <div class="container">
            <div>
				<span style="text-align: left; float: left; width: 30%;">
				Made with <a target="_blank" href="http://materializecss.com">Materialize</a>
				</span>
				<span style="text-align: center; float: left; width: 40%;">
				Copyright © 2018 <a href="https://twitter.com/SanfteSchorle">Thomas Driessen</a>
				</span>
                <span style="text-align: right; float: left; width: 30%;">
				Powered by <a target="_blank" href="http://jekyllrb.com/">Jekyll</a>
                </span>
            </div>
        </div>
    </div>
</footer>      
	<!--  Scripts-->  

<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/materialize.min.js"></script>
<script src="/assets/js/init.js"></script>	
	<script src="/assets/js/content.js"></script>	
  </body>

</html>