<!DOCTYPE html>
<html lang="en"><head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
    <title>Zookeeper Server</title>
    <meta name="description" content="Zookeeper Server" />
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen,projection" href="/assets/materialize.css" />
    <link rel="canonical" href="http://localhost:4000/tutorials/distributed_osgi_tutorial/zookeeper.html" />
    <link rel="alternate" type="application/rss+xml" title="modularcode" href="/feed.xml" />
    
</head>
<!-- Is it a content or a nested page -->
	
	
	
	<style>a {color: #757575;fill:#424242;font-weight:450;}a:hover {color: #03a9f4;fill:#03a9f4;}h1,h2,h3,h4,h5,h6{color: #424242;}body{color: #212121; display: flex; min-height: 100vh; flex-direction: column;}nav ul a{color: #424242;}nav .brand-logo{color: #424242}.justify-align{text-align:justify;}nav a{color: #424242;}main{flex: 1 0 auto;}.side-nav li>a{color: #424242;}.side-nav .collapsible-header, .side-nav.fixed .collapsible-header{padding-left:32px;}.side-nav .collapsible-body li a, .side-nav.fixed .collapsible-body li a{padding-left:47px;}h1,h2,h3,h4,h5,h6{-webkit-font-smoothing: antialiased;}.icon-block{padding: 0 15px;}.icon-block .material-icons{font-size: inherit;}.row{margin-bottom:0px;}.logo img{padding-top:3px;}.page-footer{background-color:#03a9f4; padding-top: 0px;}.nav-button{width:20px; height:20px; viewBox:0 0 20 20;}footer h5{color:#FFFFFF;}hr{background-color:#bdbdbd;}.divider{background-color:#bdbdbd;}img{max-width: 100%; height: auto;}.page-footer .footer-copyright{background-color:#03a9f4;}/* Code Highlighting */.highlight .c { color: #bdbdbd; font-style: italic } /* Comment */.highlight .k { color: #212121; font-weight: bold } /* Keyword */.highlight .cm { color: #bdbdbd; font-style: italic } /* Comment.Multiline */.highlight .c1 { color: #bdbdbd; font-style: italic } /* Comment.Single */.highlight .kc { color: #424242; font-weight: bold } /* Keyword.Constant */.highlight .kd { color: #212121; font-weight: bold } /* Keyword.Declaration */.highlight .kn { color: #424242; font-weight: bold } /* Keyword.Namespace */.highlight .kp { color: #424242; font-weight: bold } /* Keyword.Pseudo */.highlight .kr { color: #424242; font-weight: bold } /* Keyword.Reserved */.highlight .kt { color: #424242; font-weight: bold } /* Keyword.Type */.highlight .s { color: #757575 } /* Literal.String */.highlight .n { color: #03a9f4 } /* Name */.highlight .na { color: #03a9f4 } /* Name.Attribute */.highlight .nc { color: #03a9f4} /* Name.Class */.highlight .nd { color: #757575 } /* Name.Decorator */.highlight .nf { color: #03a9f4 } /* Name.Function */.highlight .mf { color: #757575 } /* Literal.Number.Float */.highlight .mh { color: #757575 } /* Literal.Number.Hex */.highlight .mi { color: #757575 } /* Literal.Number.Integer */.highlight .mo { color: #757575 } /* Literal.Number.Oct */.highlight .sb { color: #757575 } /* Literal.String.Backtick */.highlight .sc { color: #757575 } /* Literal.String.Char */.highlight .sd { color: #757575 } /* Literal.String.Doc */.highlight .s2 { color: #757575 } /* Literal.String.Double */.highlight .se { color: #757575 } /* Literal.String.Escape */.highlight .sh { color: #757575 } /* Literal.String.Heredoc */.highlight .si { color:#757575 } /* Literal.String.Interpol */.highlight .sx { color: #757575 } /* Literal.String.Other */.highlight .sr { color: #757575 } /* Literal.String.Regex */.highlight .s1 { color: #757575 } /* Literal.String.Single */.highlight .ss { color: #757575 } /* Literal.String.Symbol */.highlight {tab-size: 4;}div.highlighter-rouge{padding:5px;background:#f5f5f5;border:1px solid #bdbdbd;border-radius:4px;}div.highlight pre.highlight{margin:0px;}code.highlighter-rouge{padding:0px 3px;background:#f5f5f5;border:1px solid #bdbdbd;border-radius:3px;}/* Make headers a little bit smaller */h1{font-size:2.8rem;}h2{font-size:2.5rem;}h3{font-size:2.1rem;}h4{font-size:1.8rem;}h5{font-size:1.3rem;}h6{font-size:1rem;}/* Plain text */p{text-align:justify;}/* Blockquotes */blockquote{border-left:3px solid #03a9f4;font-style:italic;font-weight:300;}/* Tables */table.striped>tbody>tr:nth-child(odd){background-color:#f5f5f5;}/* Cards */.card .card-image .card-title{color: #212121; font-weight: 600; padding-bottom: 0px; padding-left:12px; padding-right: 12px;}.card-content{color: #757575;}.card .card-content{padding-top: 5px;}.card .card-action a:not(.btn):not(.btn-large):not(.btn-large):not(.btn-floating){color: #424242;}.card .card-action a:not(.btn):not(.btn-large):not(.btn-large):not(.btn-floating):hover{color: #03a9f4;}.card.small{height: 225px;}.card-placeholder-image{color:#bdbdbd;}.card-image img{opacity: 0.3;}.card-image h2{opacity: 0.3;}.card .card-image{min-height:60%;}/* Breadcrumbs */nav{background-color: #FFFFFF;}a.breadcrumb{color: #757575;}.breadcrumb:last-child{color:#03a9f4;}.breadcrumb:before{color:#757575;font-size:15px;}nav.breadcrumbs{box-shadow:none;margin-top:4px;}ul.collapsible{list-style-type: none;padding:0px;}.collapsible-header{border-bottom:0px;}.collapsible-body{padding:5px;}/* Table of Contents */.second-level{padding:0px;}.table-of-contents .second-level a{padding-left:40px;font-size:13px;}.table-of-contents a{color:#757575;}.table-of-contents a:hover{border-left:1px solid #03a9f4;color:#03a9f4;}.table-of-contents a.active{border-left:2px solid #03a9f4;color:#757575;}.toc-wrapper li{padding:1px;}/* Navigation Arrows */.prev-nav{top: 50%;left: 3%;position:fixed;}.next-nav{top: 50%;right: 3%;position:fixed;}</style>

  <body>
	<!-- Navigation Header -->
	<nav class="white lighten-1" role="navigation">
	<div class="nav-wrapper container">
		<a id="logo-container" class="brand-logo logo show-on-medium-and-up hide-on-small-only" href="/"><img src="/logo.png"></a>
		<a id="logo-container" class="brand-logo logo show-on-small hide-on-med-and-up" href="/"><img src="/logo-small.png"></a>
	  
	  
	
	  <ul class="right hide-on-med-and-down">
		
			
			<li><a href="/tutorials.html">Tutorials</a></li>
		
			
			<li><a href="/modules.html">Modules</a></li>
		
			
			<li><a href="/projects.html">Projects</a></li>
		
			
			<li><a href="/contribute.html">Contribute</a></li>
		
		
			<li>
				<a title="modularcode.site on GitHub" href="https://github.com/Sandared/modularcode.site"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>github</title>
						<path d="M10 0C4.477 0 0 4.477 0 10c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.342-3.369-1.342-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.268 2.75 1.026A9.578 9.578 0 0 1 10 4.836c.85.004 1.705.114 2.504.337 1.909-1.294 2.747-1.026 2.747-1.026.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.579.688.481C17.137 18.163 20 14.418 20 10c0-5.523-4.478-10-10-10" fill-rule="evenodd">
						</path>
					</svg>					
				</a>
			</li>
		
		
		
			<li>
				<a title="modularco_de on Twitter" href="https://twitter.com/modularco_de"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>twitter</title>
						<path d="M15.115 7.788c.005.11.009.223.009.335 0 3.43-2.611 7.384-7.386 7.384-1.467 0-2.831-.43-3.98-1.166a5.244 5.244 0 0 0 3.843-1.075 2.596 2.596 0 0 1-2.424-1.801 2.645 2.645 0 0 0 1.171-.045 2.597 2.597 0 0 1-2.082-2.544v-.033c.351.194.752.311 1.177.324a2.59 2.59 0 0 1-1.154-2.16c0-.475.127-.92.35-1.305A7.37 7.37 0 0 0 9.99 8.414a2.596 2.596 0 0 1 4.423-2.367 5.174 5.174 0 0 0 1.648-.63 2.602 2.602 0 0 1-1.142 1.436 5.17 5.17 0 0 0 1.491-.41 5.233 5.233 0 0 1-1.295 1.345M10 0C4.486 0 0 4.486 0 10s4.486 10 10 10 10-4.486 10-10S15.514 0 10 0" fill-rule="evenodd">
						</path>
					</svg>			
				</a>
			</li>
		
	  </ul>

	  <ul id="nav-mobile" class="side-nav">
		<li><a href="http://localhost:4000">Home</a></li>
		<li class="divider"></li>
		
			
			<li><a href="/tutorials.html">Tutorials</a></li>
			<li class="divider"></li>
		
			
			<li><a href="/modules.html">Modules</a></li>
			<li class="divider"></li>
		
			
			<li><a href="/projects.html">Projects</a></li>
			<li class="divider"></li>
		
			
			<li><a href="/contribute.html">Contribute</a></li>
			<li class="divider"></li>
		
		
			<li>
				<a title="modularcode.site on GitHub" href="https://github.com/Sandared/modularcode.site"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>github</title>
						<path d="M10 0C4.477 0 0 4.477 0 10c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.342-3.369-1.342-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.268 2.75 1.026A9.578 9.578 0 0 1 10 4.836c.85.004 1.705.114 2.504.337 1.909-1.294 2.747-1.026 2.747-1.026.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.579.688.481C17.137 18.163 20 14.418 20 10c0-5.523-4.478-10-10-10" fill-rule="evenodd">
						</path>
					</svg>					
				</a>
			</li>
			<li class="divider"></li>
		
		
		
			<li>
				<a title="modularco_de on Twitter" href="https://twitter.com/modularco_de"> 
					<svg class="nav-button" xmlns="http://www.w3.org/2000/svg">
						<title>twitter</title>
						<path d="M15.115 7.788c.005.11.009.223.009.335 0 3.43-2.611 7.384-7.386 7.384-1.467 0-2.831-.43-3.98-1.166a5.244 5.244 0 0 0 3.843-1.075 2.596 2.596 0 0 1-2.424-1.801 2.645 2.645 0 0 0 1.171-.045 2.597 2.597 0 0 1-2.082-2.544v-.033c.351.194.752.311 1.177.324a2.59 2.59 0 0 1-1.154-2.16c0-.475.127-.92.35-1.305A7.37 7.37 0 0 0 9.99 8.414a2.596 2.596 0 0 1 4.423-2.367 5.174 5.174 0 0 0 1.648-.63 2.602 2.602 0 0 1-1.142 1.436 5.17 5.17 0 0 0 1.491-.41 5.233 5.233 0 0 1-1.295 1.345M10 0C4.486 0 0 4.486 0 10s4.486 10 10 10 10-4.486 10-10S15.514 0 10 0" fill-rule="evenodd">
						</path>
					</svg>			
				</a>
			</li>
			<li class="divider"></li>
		
	  </ul>        

	  <a data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
	</div>
</nav>
	
	
	
  <main>	
  <div class="container">
		<div class="row">	
		
			<div id="text-content" class="section col s12 l10">
				


<nav class="breadcrumbs">
	<div class="nav-wrapper">
	
	
		
	
		
			
			
			
			
			
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
			
				
					
					<a href="http://localhost:4000/tutorials.html" class="breadcrumb">Tutorials</a>
				
			
		
	
		
			
			
			
			
			
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
					
				
				<a href="http://localhost:4000/tutorials/distributed_osgi_tutorial.html" class="breadcrumb">Distributed OSGi with Zookeeper</a>
				
			
		
	
		
			
			
			
			
			
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
							
				
				
					
				
				<a href="http://localhost:4000/tutorials/distributed_osgi_tutorial/zookeeper.html" class="breadcrumb">Zookeeper Server</a>
				
			
		
	
	</div>
</nav>

				<h1 id="zookeeper-server">Zookeeper Server</h1>

<p><img src="img/overview-zookeeper.png" alt="Chat Service Zookeeper" /></p>

<h2 id="distributed-osgi">Distributed OSGi</h2>

<p>Distributed OSGi is almost unbelievably easy to use. To <em>export</em> a service from a framework, all you have to do is set a simple service property:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>service.exported.interfaces=*
</code></pre></div></div>

<p>The <em>Distribution Provider</em> will detect such services and make them available to other frameworks. To which frameworks they are made available depends on the <em>Topology Manager</em>. A Topology Manager orchestrates a cluster of computers by listening to the life cycle of services and using some <em>policy</em> how to distribute these services over the cluster. The Topology Manager uses the Remote Service Admin service to export and import services. The Topology Manager also uses the Remote Service Admin specification for the publication and discovery of the exported services.</p>

<p>The most common Topology Manager is the <em>promiscuous</em> one. This Topology Manager exports all exported services (with the magic service property) and imports all exported services.</p>

<p>In OSGi enRoute there we include the <a href="http://www.amdatu.org/">Amdatu</a> implementation, which is the R6 Reference Implementation. By default the discovery is based on Multi cast DNS. However, in this tutorial we will use the Zookeeper discovery because lots of networks nowadays disable multicast.</p>

<p>In the Zookeper mode, an agent will register itself in Zookeeper and at the same time listen to registrations from other agents. This way each agent can find all other agents.</p>

<p>In this section we will export the service and setup a Zookeeper server. Any framework that will use this Zookeeper server for discovery will be able to see all the exported services from that framework.</p>

<h2 id="setting-up-a-zookeeper-server">Setting up a Zookeeper server</h2>

<p>Probably the easiest way is to download the Zookeeper distribution and <a href="https://zookeeper.apache.org/doc/r3.3.3/zookeeperStarted.html">start a server from the command line</a>. However, it is much more fun to stay in Bndtools. We will therefore create a server in our local framework.</p>

<p>Therefore, create a new project <code class="highlighter-rouge">osgi.enroute.examples.zookeeper.provider</code> (use your own namespace of course but end in <code class="highlighter-rouge">.provider</code>). Then we need to replace the ZookeerImpl class with the following code:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">osgi</span><span class="o">.</span><span class="na">enroute</span><span class="o">.</span><span class="na">examples</span><span class="o">.</span><span class="na">zookeeper</span><span class="o">.</span><span class="na">provider</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.zookeeper.server.ServerConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.zookeeper.server.ZooKeeperServerMain</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.framework.BundleContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.service.component.annotations.Activate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.service.component.annotations.Component</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.service.component.annotations.Deactivate</span><span class="o">;</span>

<span class="nd">@Component</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"osgi.enroute.examples.zookeeper"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ZookeeperImpl</span> <span class="kd">extends</span> <span class="n">ZooKeeperServerMain</span> <span class="o">{</span>
	
	<span class="kd">private</span> <span class="n">Thread</span> <span class="n">thread</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">ServerConfig</span> <span class="n">config</span><span class="o">;</span>

	<span class="nd">@Activate</span>
	<span class="kt">void</span> <span class="nf">activate</span><span class="o">(</span><span class="n">BundleContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">File</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getDataFile</span><span class="o">(</span><span class="s">"zookeeper"</span><span class="o">);</span>
		<span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerConfig</span><span class="o">();</span>
		<span class="n">config</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span> <span class="s">"6789"</span><span class="o">,</span> <span class="n">dir</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">()</span> <span class="o">});</span>
		<span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">zk</span><span class="o">,</span> <span class="s">"osgi.enroute.examples.zookeeper"</span><span class="o">);</span>
		<span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="nd">@Deactivate</span>
	<span class="kt">void</span> <span class="nf">deactivate</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">shutdown</span><span class="o">();</span>
		<span class="n">thread</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">zk</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">runFromConfig</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ZK Exiting"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This code just binds a Zookeeper server life cycle to the component. It starts a thread for the server when activated and it shuts the server down when deactivated.</p>

<h2 id="build">Build</h2>

<p>The code will not compile, we need the <code class="highlighter-rouge">org.apache.hadoop.zookeeper</code> bundle. 
You can add this bundle from Maven Central. Go to the <a href="https://search.maven.org">search.maven.org</a> view 
and search for <code class="highlighter-rouge">org.apache.hadoop.zookeeper</code>. Click on the version number and copy the 
<code class="highlighter-rouge">&lt;dependency/&gt;</code> element. Then paste this in the <code class="highlighter-rouge">&lt;dependencies/&gt;</code> element in the
<code class="highlighter-rouge">cmf/central.xml</code> file.</p>

<p class="bug">Make sure to touch (change and save the <code class="highlighter-rouge">cnf/build.cnf</code> file) to refresh the workspace.</p>

<p>Now double click the <code class="highlighter-rouge">bnd.bnd</code> file and select the <code class="highlighter-rouge">Build</code> tab. Then drag the 
<code class="highlighter-rouge">org.apache.hadoop.zookeeper</code> bundle from the <code class="highlighter-rouge">Central</code> repository on the <code class="highlighter-rouge">Build Path</code> list. 
If you then go to the <code class="highlighter-rouge">Source</code> tab you should see the following <code class="highlighter-rouge">-buildpath</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-buildpath: \
	osgi.enroute.base.api, \
	org.apache.hadoop.zookeeper;version=3.3.6
</code></pre></div></div>

<p class="note">In certain cases the file is not downloaded yet and you get compile errors. Wait a bit and clean all projects.</p>

<h2 id="command">Command</h2>

<p>It would be convenient if we could check nodes in Zookeeper. We therefore could add the following command:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">osgi</span><span class="o">.</span><span class="na">enroute</span><span class="o">.</span><span class="na">examples</span><span class="o">.</span><span class="na">zookeeper</span><span class="o">.</span><span class="na">provider</span><span class="o">;</span>
	
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.zookeeper.ZooKeeper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.service.component.annotations.Activate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.service.component.annotations.Deactivate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.service.component.annotations.Component</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">osgi.enroute.debug.api.Debug</span><span class="o">;</span>

<span class="nd">@Component</span><span class="o">(</span>
  <span class="n">property</span> <span class="o">=</span> <span class="o">{</span> 
	<span class="n">Debug</span><span class="o">.</span><span class="na">COMMAND_SCOPE</span> <span class="o">+</span> <span class="s">"=zk"</span><span class="o">,</span>  
	<span class="n">Debug</span><span class="o">.</span><span class="na">COMMAND_FUNCTION</span> <span class="o">+</span> <span class="s">"=zk"</span><span class="o">,</span> 
	<span class="n">Debug</span><span class="o">.</span><span class="na">COMMAND_FUNCTION</span> <span class="o">+</span> <span class="s">"=ls"</span><span class="o">,</span>
	<span class="n">Debug</span><span class="o">.</span><span class="na">COMMAND_FUNCTION</span> <span class="o">+</span> <span class="s">"=data"</span> 
  <span class="o">},</span> 
  <span class="n">service</span> <span class="o">=</span> <span class="n">Command</span><span class="o">.</span><span class="na">class</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Command</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="n">ZooKeeper</span> <span class="n">zk</span><span class="o">;</span>

  <span class="kd">public</span> <span class="n">String</span> <span class="nf">zk</span><span class="o">()</span> <span class="o">{</span>
	<span class="k">return</span>
	  <span class="s">"zk              help\n"</span>
	<span class="o">+</span> <span class="s">"ls &lt;path&gt;       list children\n"</span>
	<span class="o">+</span> <span class="s">"data &lt;path&gt;     show data of node\n"</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Activate</span> <span class="kt">void</span> <span class="nf">activate</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
	<span class="k">this</span><span class="o">.</span><span class="na">zk</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ZooKeeper</span><span class="o">(</span><span class="s">"localhost:6789"</span><span class="o">,</span> <span class="mi">10000</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
  <span class="o">}</span>
		
  <span class="nd">@Deactivate</span> <span class="kt">void</span> <span class="nf">deactivate</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
	<span class="k">this</span><span class="o">.</span><span class="na">zk</span><span class="o">.</span><span class="na">close</span><span class="o">();;</span>
  <span class="o">}</span>
	
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">ls</span><span class="o">(</span><span class="n">String</span> <span class="n">path</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
	<span class="k">return</span> <span class="n">zk</span><span class="o">.</span><span class="na">getChildren</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">String</span> <span class="nf">data</span><span class="o">(</span><span class="n">String</span> <span class="n">path</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
	<span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">zk</span><span class="o">.</span><span class="na">getData</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="s">"UTF-8"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="running">Running</h2>

<p>We need to create a bndrun file now, let’s call it <code class="highlighter-rouge">zk.bndrun</code>. Double click this file and select the <code class="highlighter-rouge">Run</code> tab. Drag the <code class="highlighter-rouge">osgi.enroute.examples.zookeeper.provider</code> bundle from the <code class="highlighter-rouge">Available Bundles</code> list to the `Run Requirements list. You should also add the Gogo command and shell bundle so we can take a peek at the store.</p>

<p>Resolve.</p>

<p>Since this is Zookeeper we should pay attention to the persistence. A Zookeeper node keeps a database that is synchronized with other Zookeepers. In this bundle we store the Zookeeper database in the Bundle’s private storage area. By default this area is cleaned when the framework starts up. We should therefore keep the persistence area between restarts. You can do this by adding the following line to the <code class="highlighter-rouge">Source</code> tab of your <code class="highlighter-rouge">bndrun</code> file.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-runkeep: true
</code></pre></div></div>

<p>We’re now ready to roll, save the <code class="highlighter-rouge">bndrun</code> file and click on the <code class="highlighter-rouge">Run</code> button in the <code class="highlighter-rouge">Run</code> tab.</p>

<p>We now have a Zookeper server running that we can use as the discovery server for distributed OSGi.</p>

<p>All Zookeepers keep their own zoo in <code class="highlighter-rouge">/zookeeper</code>. We can therefore now execute the following command:</p>

<div class="shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>g! zk:ls /
zookeeper
g! zk:ls /zookeeper
quota
</code></pre></div></div>

<p>Not very useful yet but we’re preparing for the (near) future.</p>


		    </div>
			<div class="col hide-on-med-and-down l2">
				<div id="toc-wrapper" class="toc-wrapper pin-top">
				  <ul id="toc" class="section table-of-contents">
					
				  </ul>
				</div>
			</div>
			
			
				
				<div class="col s6 left-align hide-on-large-only show-on-med-and-down"><a href="configuration.html"><i class="large material-icons">keyboard_arrow_left</i></a></div>
			
			
				<div class="col s6  right-align hide-on-large-only show-on-med-and-down"><a href="distributing.html"><i class="large material-icons">keyboard_arrow_right</i></a></div>
			
			
			
				<div class="prev-nav hide-on-med-and-down"><a href="configuration.html"><i class="small material-icons">keyboard_arrow_left</i></a></div>
			
			
				<div class="next-nav hide-on-med-and-down"><a href="distributing.html"><i class="small material-icons">keyboard_arrow_right</i></a></div>
			
		
			
    </div> 
	
  </div>
  </main>
	<footer class="page-footer">
    <!--<div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5>Lorem Ipsum</h5>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        </div>
      </div>
    </div>-->
    <div class="footer-copyright">
        <div class="container">
            <div>
				<span style="text-align: left; float: left; width: 30%;">
				Made with <a target="_blank" href="http://materializecss.com">Materialize</a>
				</span>
				<span style="text-align: center; float: left; width: 40%;">
				Copyright © 2018 <a href="https://twitter.com/SanfteSchorle">Thomas Driessen</a>
				</span>
                <span style="text-align: right; float: left; width: 30%;">
				Powered by <a target="_blank" href="http://jekyllrb.com/">Jekyll</a>
                </span>
            </div>
        </div>
    </div>
</footer>      
	<!--  Scripts-->  

<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/materialize.min.js"></script>
<script src="/assets/js/init.js"></script>	
	<script src="/assets/js/content.js"></script>	
  </body>

</html>